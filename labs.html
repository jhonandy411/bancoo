<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Subir valores de laboratorio a Firestore (4 docs)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; padding: 24px; }
    button { padding: 10px 16px; border-radius: 8px; border: 1px solid #0ea5e9; background: #0ea5e9; color: #fff; font-weight: 600; cursor: pointer; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    pre { background:#0b1020; color:#e2e8f0; padding:12px; border-radius:8px; overflow:auto; max-height:50vh; }
    .ok { color:#16a34a; } .err { color:#dc2626; } .muted{color:#64748b}
    ul{line-height:1.5}
  </style>
</head>
<body>
  <h1>Subir valores de laboratorio a Firestore (documentos separados)</h1>
  <p class="muted">Crea/actualiza <code>labs/serum</code>, <code>labs/blood</code>, <code>labs/cerebrospinal</code> y <code>labs/urine_bmi</code>.</p>
  <button id="uploadBtn">Subir 4 documentos</button>
  <ul id="status"></ul>

  <details>
    <summary>Ver JSON maestro</summary>
    <pre id="jsonView"></pre>
  </details>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

    // ğŸ‘‰ REEMPLAZAR
    const firebaseConfig = {
      apiKey: "AIzaSyCK8SLFcVDyvLUUzVjOWOBDGHi0kD8-cKs",
      authDomain: "bancomicina-62bfe.firebaseapp.com",
      projectId: "bancomicina-62bfe",
      storageBucket: "bancomicina-62bfe.appspot.com",
      messagingSenderId: "737254665977",
      appId: "1:737254665977:web:dbafb6c16ad9d96fae7c28"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    // ====== Utilidad: agrega metadatos de orden en cada objeto ======
    function addOrderMetadata(node) {
      if (node && typeof node === "object" && !Array.isArray(node)) {
        const keys = Object.keys(node);
        // Construimos un nuevo objeto con _order primero para dejar explÃ­cito el orden deseado
        const out = { _order: keys };
        for (const k of keys) {
          out[k] = addOrderMetadata(node[k]);
        }
        return out;
      }
      return node;
    }

    // ========= DATOS =========
    const master = {
      "Serum": {

        
        "Serum": {
  "Alanine aminotransferase (ALT)": { "ref": "10â€“40 U/L", "si": "10â€“40 U/L" },
  "Aspartate aminotransferase (AST)": { "ref": "12â€“38 U/L", "si": "12â€“38 U/L" },
  "Alkaline phosphatase": { "ref": "25â€“100 U/L", "si": "25â€“100 U/L" },
  "Amylase": { "ref": "25â€“125 U/L", "si": "25â€“125 U/L" },

  "Bilirubin": {
    "Total": { "ref": "0.1â€“1.0 mg/dL", "si": "2â€“17 Âµmol/L" },
    "Direct": { "ref": "0.0â€“0.3 mg/dL", "si": "0â€“5 Âµmol/L" }
  },

  "Calcium": { "ref": "8.4â€“10.2 mg/dL", "si": "2.1â€“2.6 mmol/L" }
},


        
"Cholesterol": {
  "Total": { 
    "ref": "Normal: <200 mg/dL // High: >240 mg/dL", 
    "si": "<5.2 mmol/L // >6.2 mmol/L" 
  },
  "HDL": { 
    "ref": "40â€“60 mg/dL", 
    "si": "1.0â€“1.6 mmol/L" 
  },
  "LDL": { 
    "ref": "<160 mg/dL", 
    "si": "<4.2 mmol/L" 
  },
  "Triglycerides": { 
    "ref": "Normal: <150 mg/dL // Borderline: 151â€“199 mg/dL", 
    "si": "<1.70 mmol/L // 1.71â€“2.25 mmol/L" 
  },
  "Cortisol": { 
    "ref": "0800 h: 5â€“23 Âµg/dL // 1600 h: 3â€“15 Âµg/dL /// 2000 h: <50% of 0800 h", 
    "si": "138â€“635 nmol/L // 82â€“413 nmol/L /// Fraction of 0800 h: <0.50" 
  },
  "Creatine kinase": {
    "Male": { "ref": "25â€“90 U/L", "si": "25â€“90 U/L" },
    "Female": { "ref": "10â€“70 U/L", "si": "10â€“70 U/L" }
  },
  "Creatinine": { 
    "ref": "0.6â€“1.2 mg/dL", 
    "si": "53â€“106 Âµmol/L" 
  },
  "Urea nitrogen": { 
    "ref": "7â€“18 mg/dL", 
    "si": "2.5â€“6.4 mmol/L" 
  },
  "Creatinine clearance": {
    "Male": { "ref": "97â€“137 mL/min", "si": "97â€“137 mL/min" },
    "Female": { "ref": "88â€“128 mL/min", "si": "88â€“128 mL/min" }
  }
},






"Electrolytes, serum": {
  "Sodium (Na+)": { "ref": "136â€“146 mEq/L", "si": "136â€“146 mmol/L" },
  "Potassium (K+)": { "ref": "3.5â€“5.0 mEq/L", "si": "3.5â€“5.0 mmol/L" },
  "Chloride (Clâˆ’)": { "ref": "95â€“105 mEq/L", "si": "95â€“105 mmol/L" },
  "Bicarbonate (HCO3âˆ’)": { "ref": "22â€“28 mEq/L", "si": "22â€“28 mmol/L" },
  "Magnesium (Mg2+)": { "ref": "1.5â€“2.0 mg/dL", "si": "0.75â€“1.0 mmol/L" },

  "Ferritin": {
    "Male": { "ref": "20â€“250 ng/mL", "si": "20â€“250 Âµg/L" },
    "Female": { "ref": "10â€“120 ng/mL", "si": "10â€“120 Âµg/L" }
  },
  "Follicle-stimulating hormone": {
    "Male": { "ref": "4â€“25 mIU/mL", "si": "4â€“25 U/L" },
    "Female premenopause": { "ref": "4â€“30 mIU/mL", "si": "4â€“30 U/L" },
    "Female midcycle peak": { "ref": "10â€“90 mIU/mL", "si": "10â€“90 U/L" },
    "Female postmenopause": { "ref": "40â€“250 mIU/mL", "si": "40â€“250 U/L" }
  },
  "Glucose": {
    "Fasting": { "ref": "70â€“100 mg/dL", "si": "3.8â€“5.6 mmol/L" },
    "Random, non-fasting": { "ref": "<140 mg/dL", "si": "<7.77 mmol/L" }
  },
  "Growth hormone - arginine stimulation": {
    "Fasting": { "ref": "<5 ng/mL", "si": "<5 Âµg/L" },
    "Provocative stimuli": { "ref": ">7 ng/mL", "si": ">7 Âµg/L" }
  },
  "Iron": {
    "Male": { "ref": "65â€“175 Âµg/dL", "si": "11.6â€“31.3 Âµmol/L" },
    "Female": { "ref": "50â€“170 Âµg/dL", "si": "9.0â€“30.4 Âµmol/L" }
  },
  "Total iron-binding capacity": { "ref": "250â€“400 Âµg/dL", "si": "44.8â€“71.6 Âµmol/L" },
  "Transferrin": { "ref": "200â€“360 mg/dL", "si": "2.0â€“3.6 g/L" },
  "Lactate dehydrogenase": { "ref": "45â€“200 U/L", "si": "45â€“200 U/L" },
  "Lipase": { "ref": "13â€“60 U/L", "si": "13â€“60 U/L" },
  "Luteinizing hormone": {
    "Male": { "ref": "6â€“23 mIU/mL", "si": "6â€“23 U/L" },
    "Female follicular phase": { "ref": "5â€“30 mIU/mL", "si": "5â€“30 IU/L" },
    "Female midcycle": { "ref": "75â€“150 mIU/mL", "si": "75â€“150 IU/L" },
    "Female postmenopause": { "ref": "30â€“200 mIU/mL", "si": "30â€“200 IU/L" }
  },
  "Osmolality": { "ref": "275â€“295 mOsmol/kg H2O", "si": "275â€“295 mOsmol/kg H2O" },
  "Intact parathyroid hormone (PTH)": { "ref": "10â€“60 pg/mL", "si": "10â€“60 ng/L" },
  "Phosphorus (inorganic)": { "ref": "3.0â€“4.5 mg/dL", "si": "1.0â€“1.5 mmol/L" },
  "Prolactin (hPRL)": {
    "Male": { "ref": "<17 ng/mL", "si": "<17 Âµg/L" },
    "Female": { "ref": "<25 ng/mL", "si": "<25 Âµg/L" }
  }
},







        "Proteins": {
          "Total": { "ref": "6.0â€“7.8 g/dL", "si": "60â€“78 g/L" },
          "Albumin": { "ref": "3.5â€“5.5 g/dL", "si": "35â€“55 g/L" },
          "Globulin": { "ref": "2.3â€“3.5 g/dL", "si": "23â€“35 g/L" },
                  "Troponin I": { "ref": "â‰¤0.04 ng/mL", "si": "â‰¤0.04 Âµg/L" },
        "TSH": { "ref": "0.4â€“4.0 Î¼U/mL", "si": "0.4â€“4.0 mIU/L" },
        "Thyroidal iodine (123I) uptake": { "ref": "8%â€“30% of administered dose/24 h", "si": "0.08â€“0.30/24 h" },
        "Thyroxine (T4)": { "ref": "5â€“12 Âµg/dL", "si": "64â€“155 nmol/L" },
        "Free T4": { "ref": "0.9â€“1.7 ng/dL", "si": "12.0â€“21.9 pmol/L" },
        "Triiodothyronine (T3) (RIA)": { "ref": "100â€“200 ng/dL", "si": "1.5â€“3.1 nmol/L" },
        "Triiodothyronine (T3) resin uptake": { "ref": "25%â€“35%", "si": "0.25â€“0.35" },
        "Uric acid": { "ref": "3.0â€“8.2 mg/dL", "si": "0.18â€“0.48 mmol/L" },
        },

        "Immunoglobulins": {
          "IgA": { "ref": "76â€“390 mg/dL", "si": "0.76â€“3.90 g/L" },
          "IgE": { "ref": "0â€“380 IU/mL", "si": "0â€“380 kIU/L" },
          "IgG": { "ref": "650â€“1500 mg/dL", "si": "6.5â€“15.0 g/L" },
          "IgM": { "ref": "50â€“300 mg/dL", "si": "0.5â€“3.0 g/L" }
        },
        "Gases, arterial blood (room air)": {
          "pH": { "ref": "7.35â€“7.45", "si": "[H+] 36â€“44 nmol/L" },
          "Pco2": { "ref": "33â€“45 mm Hg", "si": "4.4â€“5.9 kPa" },
          "Po2": { "ref": "75â€“105 mm Hg", "si": "10.0â€“14.0 kPa" }
        }
      },





      
      "Cerebrospinal": {
        "Cell count": { "ref": "0â€“5/mmÂ³", "si": "0â€“5 Ã— 10^6/L" },
        "Chloride": { "ref": "118â€“132 mEq/L", "si": "118â€“132 mmol/L" },
        "Gamma globulin": { "ref": "3%â€“12% total proteins", "si": "0.03â€“0.12" },
        "Glucose": { "ref": "40â€“70 mg/dL", "si": "2.2â€“3.9 mmol/L" },
        "Pressure": { "ref": "70â€“180 mm Hâ‚‚O", "si": "70â€“180 mm Hâ‚‚O" },
        "Proteins, total": { "ref": "<40 mg/dL", "si": "<0.40 g/L" }
      },
      "Blood": {
        "Erythrocyte count": {
          "Male": { "ref": "4.3â€“5.9 million/mmÂ³", "si": "4.3â€“5.9 Ã— 10Â¹Â²/L" },
          "Female": { "ref": "3.5â€“5.5 million/mmÂ³", "si": "3.5â€“5.5 Ã— 10Â¹Â²/L" }
        },
        "Erythrocyte sedimentation rate (Westergren)": {
          "Male": { "ref": "0â€“15 mm/h", "si": "0â€“15 mm/h" },
          "Female": { "ref": "0â€“20 mm/h", "si": "0â€“20 mm/h" }
        },
        "Hematocrit": {
          "Male": { "ref": "41%â€“53%", "si": "0.41â€“0.53" },
          "Female": { "ref": "36%â€“46%", "si": "0.36â€“0.46" }
        },
        "Hemoglobin, blood": {
          "Male": { "ref": "13.5â€“17.5 g/dL", "si": "135â€“175 g/L" },
          "Female": { "ref": "12.0â€“16.0 g/dL", "si": "120â€“160 g/L" }
        },
        "Hemoglobin A1c": { "ref": "â‰¤6%", "si": "â‰¤42 mmol/mol" },
        "Hemoglobin, plasma": { "ref": "<4 mg/dL", "si": "<0.62 mmol/L" },
        "Leukocyte count (WBC)": { "ref": "4500â€“11,000/mmÂ³", "si": "4.5â€“11.0 Ã— 10â¹/L" },
        "Neutrophils, segmented": { "ref": "54%â€“62%", "si": "0.54â€“0.62" },
        "Neutrophils, bands": { "ref": "3%â€“5%", "si": "0.03â€“0.05" },
        "Eosinophils": { "ref": "1%â€“3%", "si": "0.01â€“0.03" },
        "Basophils": { "ref": "0%â€“0.75%", "si": "0.00â€“0.0075" },
        "Lymphocytes": { "ref": "25%â€“33%", "si": "0.25â€“0.33" },
        "Monocytes": { "ref": "3%â€“7%", "si": "0.03â€“0.07" },
        "CD4+ T-lymphocyte count": { "ref": ">500/mmÂ³", "si": ">0.5 Ã— 10â¹/L" },
        "Platelet count": { "ref": "150,000â€“400,000/mmÂ³", "si": "150â€“400 Ã— 10â¹/L" },
        "Reticulocyte count": { "ref": "0.5%â€“1.5%", "si": "0.005â€“0.015" },
        "D-Dimer": { "ref": "â‰¤250 ng/mL", "si": "â‰¤1.4 nmol/L" },
        "Partial thromboplastin time (PTT) (activated)": { "ref": "25â€“40 seconds", "si": "25â€“40 seconds" },
        "Prothrombin time (PT)": { "ref": "11â€“15 seconds", "si": "11â€“15 seconds" },
        "Mean corpuscular hemoglobin (MCH)": { "ref": "25â€“35 pg/cell", "si": "0.39â€“0.54 fmol/cell" },
        "Mean corpuscular hemoglobin concentration (MCHC)": { "ref": "31%â€“36% Hb/cell", "si": "4.8â€“5.6 mmol Hb/L" },
        "Mean corpuscular volume (MCV)": { "ref": "80â€“100 ÂµmÂ³", "si": "80â€“100 fL" },
        "Volume": {
          "Plasma": {
            "Male": { "ref": "25â€“43 mL/kg", "si": "0.025â€“0.043 L/kg" },
            "Female": { "ref": "28â€“45 mL/kg", "si": "0.028â€“0.045 L/kg" }
          },
          "Red cell": {
            "Male": { "ref": "20â€“36 mL/kg", "si": "0.020â€“0.036 L/kg" },
            "Female": { "ref": "19â€“31 mL/kg", "si": "0.019â€“0.031 L/kg" }
          }
        }
      },
      "Urine and BMI": {
        "Urine": {
          "Calcium": { "ref": "100â€“300 mg/24 h", "si": "2.5â€“7.5 mmol/24 h" },
          "Creatinine clearance": {
            "Male": { "ref": "97â€“137 mL/min", "si": "97â€“137 mL/min" },
            "Female": { "ref": "88â€“128 mL/min", "si": "88â€“128 mL/min" }
          },
          "Osmolality": { "ref": "50â€“1200 mOsmol/kg Hâ‚‚O", "si": "50â€“1200 mOsmol/kg Hâ‚‚O" },
          "Oxalate": { "ref": "8â€“40 Âµg/mL", "si": "90â€“445 Âµmol/L" },
          "Proteins, total": { "ref": "<150 mg/24 h", "si": "<0.15 g/24 h" },
          "17-Hydroxycorticosteroids": {
            "Male": { "ref": "3.0â€“10.0 mg/24 h", "si": "8.2â€“27.6 Âµmol/24 h" },
            "Female": { "ref": "2.0â€“8.0 mg/24 h", "si": "5.5â€“22.0 Âµmol/24 h" }
          },
          "17-Ketosteroids, total": {
            "Male": { "ref": "8â€“20 mg/24 h", "si": "28â€“70 Âµmol/24 h" },
            "Female": { "ref": "6â€“15 mg/24 h", "si": "21â€“52 Âµmol/24 h" }
          }
        },
        "Body Mass Index (BMI)": { "Adult": { "ref": "19â€“25 kg/mÂ²", "si": "" } }
      }
    };

    // Mostrar el JSON maestro
    jsonView.textContent = JSON.stringify(master, null, 2);

    const statusEl = document.getElementById("status");
    const btn = document.getElementById("uploadBtn");

    function log(msg, cls=""){ 
      const li=document.createElement("li"); li.textContent=msg; if(cls) li.className=cls; statusEl.appendChild(li);
    }

    btn.addEventListener("click", async () => {
      btn.disabled = true;
      statusEl.innerHTML = "";
      log("Subiendo documentosâ€¦");

      // Decorar payloads con orden explÃ­cito
      const serumPayload = addOrderMetadata(master["Serum"]);
      const bloodPayload = addOrderMetadata(master["Blood"]);
      const csfPayload = addOrderMetadata(master["Cerebrospinal"]);
      const urineBmiPayload = addOrderMetadata(master["Urine and BMI"]);

      // Mapa docID -> payload (cada doc guarda su secciÃ³n + _order + timestamp)
      const docs = {
        serum: { ...serumPayload, updatedAt: serverTimestamp() },
        blood: { ...bloodPayload, updatedAt: serverTimestamp() },
        cerebrospinal: { ...csfPayload, updatedAt: serverTimestamp() },
        urine_bmi: { ...urineBmiPayload, updatedAt: serverTimestamp() },
      };

      try {
        // Carga en paralelo
        await Promise.all(Object.entries(docs).map(([id, data]) =>
          setDoc(doc(db, "labs", id), data, { merge: true })
            .then(() => log(`âœ… Subido labs/${id}`, "ok"))
        ));
        log("Listo.", "ok");
      } catch (e) {
        console.error(e);
        log("âŒ Error: " + e.message, "err");
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
