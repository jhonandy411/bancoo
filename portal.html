<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bancomicina</title>
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet">
  <style>

    



@font-face {
  font-family:Lato-Light;
  font-weight:300;
  font-style:normal;
  font-display: swap;
   src: local('Lato Regular'), local('Lato-Regular'),
       url('/fonts/Lato.400.normal.woff2') format('woff2');
}
@font-face {
  font-family:Lato-Light;
  font-weight:300;
  font-style:italic;
  font-display: swap;
   src: local('Lato Regular'), local('Lato-Regular'),
       url('/fonts/Lato.400.normal.woff2') format('woff2');
}
@font-face {
  font-family:Lato-Regular;
  font-weight:400;
  font-style:normal;
  font-display: swap;
  src: local('Lato Regular'), local('Lato-Regular'),
       url('/fonts/Lato.400.normal.woff2') format('woff2');
}
@font-face {
  font-family:Lato;
  font-weight:400;
  font-style:normal;
  font-display: swap;
  src: local('Lato Regular'), local('Lato-Regular'),
       url('/fonts/Lato.400.normal.woff2') format('woff2');
}
@font-face {
  font-family:Lato;
  font-weight:400;
  font-style:italic;
  font-display: swap;
  src: local('Lato Regular'), local('Lato-Regular'),
       url('/fonts/Lato.400.normal.woff2') format('woff2');
}
@font-face {
  font-family:Lato;
  font-weight:700;
  font-style:normal;
  font-display: swap;
 src: local('Lato Regular'), local('Lato-Regular'),
       url('/fonts/Lato.400.normal.woff2') format('woff2');
}
@font-face {
  font-family:Lato;
  font-weight:700;
  font-style:italic;
  font-display: swap;
   src: local('Lato Regular'), local('Lato-Regular'),
       url('/fonts/Lato.400.normal.woff2') format('woff2');
}
@font-face {
  font-family:Lato;
  font-weight:900;
  font-style:normal;
  font-display: swap;
   src: local('Lato Regular'), local('Lato-Regular'),
       url('/fonts/Lato.400.normal.woff2') format('woff2');
}




/* Base tipográfica → usa Lato en todo */
html, body {
  height: 100%;
   margin: 0;
  overflow: hidden; /* evita que el body/html haga scroll */
  font-family: 'Lato', ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
}

/* Cualquier zona que antes llevaba Inter: sobreescribe */
.highlighting-bar,
#main-content,
#sidebar,
#subcategoria-content {
  font-family: 'Lato', 'Lato-Regular', 'Lato-Light', ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
}


.highlighting-bar {
  font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial;
}


    /* Estilos específicos para la sidebar y el contenido principal */
    .dashboard-container {
        display: flex;
        top: 3rem;    /* deja espacio para el header fijo */
  bottom: 0; 
        height: calc(100vh - 3rem); /* Altura restante de la ventana después del header */
        position: relative; /* Para que la sidebar fixed se posicione correctamente dentro */
    }


    

    #sidebar {
        width: 0; /* Inicialmente cerrada */
        height: 100%; /* Ocupa toda la altura del contenedor padre */
        position: relative; /* Fija la sidebar para que no afecte el flujo del main content */
        top: 0; /* Se posiciona debajo del header */
        left: 0;
        background-color: white;
        border-right: 1px solid #e5e7eb; /* gray-200 */
        overflow-x: hidden; /* Oculta el contenido horizontalmente cuando está cerrada */
        transition: width 0.3s ease, padding 0.3s ease; /* Transición suave para ancho y padding */
        flex-shrink: 0; /* Evita que se encoja */
        z-index: 60; /* Asegura que esté por encima del contenido principal */
        padding-top: 1rem; /* Espacio superior dentro de la sidebar */
    }

    /* Overlay del sidebar principal sobre cualquier otro */
#sidebar.open {
  width: 240px;
  /* … */
}
#sidebar.collapsed:hover {
  position: absolute; /* Sale del flujo y flota sobre el resto */
  top: 0;
  left: 0;
  z-index: 70;       /* Asegúrate de que sea mayor que el secundario */
}

/* Sidebar secundario por debajo */
#subcategoria-sidebar {
  z-index: 10;       /* Menor que el principal */
}
#main-content { overflow-x: clip; } /* o hidden */

    

   #main-content {
    flex-grow: 1;
    margin-left: 0;
    width: 100%;
    padding: 1rem 2.5rem;
    transition: none !important;
    overflow-y: auto;
    overscroll-behavior: contain;  /* ← esta línea */
}

   


    /* Estilos para los elementos internos de la sidebar */
    .sidebar-group {
        margin-bottom: 0px; /* Pequeño espacio entre grupos */
    }
    .sidebar-group a,
    .sidebar-group button {
        padding-left: 12px; /* px-3 = 0.75rem = 12px */
        padding-right: 12px;
        display: flex;
        align-items: center;
        height: 40px; /* Altura de cada elemento para consistencia */
        font-size: 1rem; /* fs-base */
        color: #374151; /* gray-700 */
        width: 100%; /* Asegura que los botones y enlaces ocupen todo el ancho disponible */
        text-align: left; /* Alinea el texto a la izquierda */
        /* Transiciones para suavizar los cambios de estado */
        transition: background-color 0.2s ease, color 0.2s ease, font-weight 0.2s ease;
    }
    .sidebar-group a i,
    .sidebar-group button i:not(.fa-chevron-down) { /* Afecta a los iconos principales, no a la flecha */
      transition: color 0.2s ease;
    }
    .sidebar-group .fa-chevron-down {
        font-size: 0.75rem; /* text-xs = 0.75rem = 12px */
        transition: transform 0.2s ease, color 0.2s ease; /* Transición para la rotación y color de la flecha */
    }
    .sidebar-group .flex.items-center span {
        margin-left: 8px; /* space-x-2 = 0.5rem = 8px */
    }

    .sidebar-group div[id^="accordion-"] a {
        padding-left: 48px; /* ml-8 + px-2 = 2rem + 0.5rem = 40px + 8px = 48px */
        height: 32px; /* py-1 = 0.25rem = 4px + 0.25rem = 4px + 16px (line-height) = 24px, ajuste para que se vea más como en la imagen */
        font-size: 0.875rem; /* text-sm = 0.875rem = 14px */
        color: #6b7280; /* gray-600 */
        transition: background-color 0.2s ease, color 0.2s ease, font-weight 0.2s ease;
    }
    .sidebar-group div[id^="accordion-"].hidden {
        display: none;
    }

    /* Estilo para el enlace o item de submenú activo */
    .active-link {
        background-color: #e0f2fe; /* blue-100 */
        color: #1d4ed8 !important; /* blue-700 */
        font-weight: 500 !important; /* medium */
    }
    .active-link i {
         color: #1d4ed8 !important; /* blue-700 */
    }
    /* Estilo para los botones de grupo cuando su acordeón está abierto */
    .sidebar-group button.accordion-open {
        background-color: #e0f2fe; /* blue-100 */
        color: #1d4ed8; /* blue-700 */
        font-weight: 500; /* medium */
    }
    .sidebar-group button.accordion-open i {
        color: #1d4ed8; /* blue-700 */
    }
    .sidebar-group button.accordion-open .fa-chevron-down {
        transform: rotate(180deg); /* Gira la flecha hacia arriba */
    }

    /* Estilos específicos para los paneles de artículos para coincidir con la imagen */
    .articles-panel-column {
        width: 18rem; /* 288px, para un ancho similar a la imagen */
        flex-shrink: 0; /* Evita que los paneles se encojan */
    }
    #articles-panel {
        align-items: flex-start; /* Asegura que los ítems flex no se estiren verticalmente y se ajusten a su contenido */
    }
    .articles-panel-list-item {
        display: flex;
        align-items: center;
        /* Padding vertical aquí se anula un poco por el divide-y, pero lo dejamos por si acaso */
        padding: 0.5rem 0.75rem; /* py-2 px-3 */
        border-radius: 0.25rem; /* rounded */
        color: #4b5563; /* gray-700 */
        transition: background-color 0.2s ease, color 0.2s ease;
    }
   /* Library: hover sin “línea blanca” debajo */
#articles-panel .articles-panel-column > ul > li { background:#fff; }
#articles-panel .articles-panel-column > ul > li:hover { background:#f3f4f6; }

/* Oculta la divide line del item actual y del siguiente */
#articles-panel .articles-panel-column > ul > li:hover,
#articles-panel .articles-panel-column > ul > li:hover + li {
  border-top-color: transparent !important;
}

/* Mantén el padding en el <a>, pero sin fondo propio */
#articles-panel .articles-panel-column > ul > li > a {
  display:flex; align-items:center;
  padding:.5rem .75rem; border-radius:0;
}
#articles-panel .articles-panel-column > ul > li > a:hover {
  background:transparent !important;
}

/* +2px arriba/abajo para el texto de cada item en las 3 columnas */
#articles-panel .articles-panel-column > ul > li > a {
  padding-top: .8rem !important;   /* antes .5rem */
  padding-bottom: .8rem !important; /* antes .5rem */
}

    .articles-panel-list-item i {
        margin-right: 0.5rem; /* space-x-2 */
        color: #6b7280; /* gray-600 */
    }
    .articles-panel-list-item.selected {
        background-color: #e0f2fe; /* blue-100 */
        color: #1d4ed8; /* blue-700 */
        font-weight: 500;
    }
    .articles-panel-list-item.selected i {
        color: #1d4ed8; /* blue-700 */
    
    }



/* Las 3 columnas del panel (título + card) comparten el mismo ancho */
#articles-panel > .flex.flex-col {
  width: 18rem;         /* = ancho de .articles-panel-column */
  flex-shrink: 0;       /* que no se encoja */
}

/* Por si el título es largo, que envuelva dentro del ancho */
#articles-panel > .flex.flex-col > h2 {
  overflow-wrap: anywhere;  /* permite corte en cualquier punto */
  word-break: break-word;   /* fallback */
}
#sidebar.collapsed .sidebar-group span {
    display: none;
}
#sidebar.collapsed .sidebar-group i {
    margin: auto;
    justify-content: center;
}
#sidebar.collapsed .sidebar-group a,
#sidebar.collapsed .sidebar-group button {
    padding-left: 0;
    padding-right: 0;
}



/* Siempre oculta la flecha en colapsado, incluso cuando está en hover */
#sidebar.collapsed .sidebar-group button .fa-chevron-down {
  display: none !important;
}




/* —— TOC (subcategoria-sidebar) —— */
#subcategoria-sidebar .toc{ padding: .25rem 0; }
#subcategoria-sidebar .toc-section{ margin: .125rem 0; }

/* Título/sección (negro, seminegrita) */
#subcategoria-sidebar .toc-h2{
  width:100%;
  padding: .35rem .65rem; 
  display:block;
  text-align:left;
  background:transparent;
  border:none;
  border-left:0 solid transparent;
  padding:.5rem .75rem;
  font-weight:400;
  font-size:0.85rem;                 /* ~16px */
  color:#111827;                  /* gray-900 */
  border-radius:.5rem;
  cursor:pointer;
}

#subcategoria-sidebar .toc-topic{
  padding:.5rem .75rem;
  font-size:1rem;
  font-weight:600;
  color:#111827;           /* gray-900 */
  background:#fff;
  position:sticky;         /* queda fijo arriba si la lista es larga */
  top:0;
  z-index:5;
}
/* Seleccionado (banda izquierda + fondo suave) */
#subcategoria-sidebar .toc-h2.is-active{
  /* fondo gris */
  background: #f3f4f6;                 /* gray-100 */
  color: #111827;                       /* gray-900 */
  font-weight: 400;

  /* sin radios para que “toque” los bordes */
  border-radius: 0 !important;

  /* hairlines arriba/abajo y borde derecho sutil SIN alterar layout */
  box-shadow:
    inset 2px 0 0 #9ca3af,             /* ← banda izquierda (un poco gruesa) */
    inset 0 .5px 0 #e5e7eb,            /* borde superior fino */
    inset 0 -.5px 0 #e5e7eb,           /* borde inferior fino */
    inset -.5px 0 0 #e5e7eb;           /* borde derecho fino */

  /* asegurá la misma altura/padding que el estado base */
  padding: .5rem .75rem;
}

/* Hover sutil (no cambia la banda ni “salta” de color) */
#subcategoria-sidebar .toc-h2:hover{
  background: #f8fafc;                 /* slate-50 */
}

/* Mantener los subenlaces como están; si querés que el activo haga juego: */
#subcategoria-sidebar .toc-a.is-active{
  background: transparent !important;
  color: #111827 !important;
  font-weight: 500;
  box-shadow: inset 3px 0 0 #9ca3af;   /* mini banda izquierda */
}
/* Quita el padding lateral del contenedor de la TOC */
#subcategoria-sidebar-content{
  padding-left: 0 !important;
  padding-right: 0 !important;
}
/* (opcional) que el item activo no tenga esquinas redondeadas */
#subcategoria-sidebar .toc-h2.is-active{ border-radius: 0; }




/* Variables de anchos para sincronizar el overlay con el TOC */
:root{
  --sb-collapsed: 40px;      /* ya la tienes */
  --subcat-width: 180px;     /* ya la tienes */
  --split-left: 0px;         /* OFFSET desde la izquierda (calculado en JS) */
  --split-w: 50vw;           /* ANCHO del panel derecho (calculado en JS) */
}

/* Split real, pegado al header de 3rem */
#video-modal.split-view{
  position: fixed;
  z-index: 40 !important;
  top: 3rem !important;
  bottom: 0 !important;
  left: var(--split-left) !important;
  width: var(--split-w) !important;
  height: auto !important;
  background-color: transparent !important;
  border-left: 1px solid rgba(229,231,235,.9);
}

/* Quita el viejo “60vw” para el área de lectura o sobrescríbelo */
body.split-view-active .dashboard-container{
  position: fixed;
  top: 3rem;
  bottom: 0;
  left: 0;
  width: calc(var(--split-left)); /* lo que NO ocupa el panel derecho */
  overflow-y: auto;
}


















#subcategoria-sidebar {
  width: var(--subcat-width);         /* mismo ancho que la principal */
  flex-shrink: 0;         /* no se encoja */
  transition: transform 0.3s ease;
}
#subcategoria-sidebar.hidden {
  display: none;
}







  /* 1) Mantener el ancho colapsado por defecto */
#sidebar.collapsed {
  width: var(--sb-collapsed);
  padding-left: 0;
  padding-right: 0;
  position: relative;
  z-index: 50; /* sobre el sub-sidebar */
  transition: width 0.0s ease;
}

/* 2) Mostrar sólo iconos cuando está colapsada */
#sidebar.collapsed .sidebar-group span { display: none; }
#sidebar.collapsed .sidebar-group button i:not(.fa-chevron-down),
#sidebar.collapsed .sidebar-group a i {
  margin: auto;
  justify-content: center;
}

/* 3) En hover, “desplegar” provisionalmente la sidebar completa */
 #sidebar.collapsed:hover {
   width: calc(var(--sb-collapsed) + var(--subcat-width));           /* ancho del overlay */
   padding-left: 0;          /* ← sin gutter izquierdo */
   padding-right: 0;         /* ← sin gutter derecho */
   box-shadow: 2px 0 8px rgba(0,0,0,0.1);
   background: rgba(255,255,255,0.95);
 }

/* 4) Al desplegar en hover, mostrar textos y submenús */
#sidebar.collapsed:hover .sidebar-group span {
  display: inline;         /* reaparecen los labels */
}

#sidebar.collapsed:hover .sidebar-group button.accordion-open i.fa-chevron-down {
  color: inherit;
}

#sidebar.collapsed:hover .sidebar-group a,
#sidebar.collapsed:hover .sidebar-group button {
  justify-content: flex-start; /* Alínea a la izquierda */
  padding-left: 12px;
  padding-right: 12px;
}

#sidebar.collapsed:hover .sidebar-group i {
  margin: 0; /* Quita el margin auto del ícono para que se alinee bien con el texto */
}



/* 5) Mantén la lógica de apertura/cierre normal intacta */
  

/* ———————————————— */
/*  Mantener main-content fijo al pasar el ratón sobre la barra comprimida  */
/* ———————————————— */

/* Si hay un segundo sidebar, lo desplazamos también para que no empuje el main */
#sidebar.collapsed:hover ~ #subcategoria-sidebar {
  left: 40px;
}

/* El main siempre a 60px de la izquierda y ancho = 100% − 60px */
#sidebar.collapsed:hover ~ #main-content {
  margin-left: var(--sb-collapsed) !important;
}

/* La barra ya no es sticky sola */
#main-content .highlighting-bar { position: static; }

/* El bloque entero (barra + breadcrumb) es sticky */
#subcat-header { position: sticky; top: 0; z-index: 40; background: #fff; }

/* Breadcrumb: oculto por defecto (lo refuerza por si quitas la clase hidden) */
#breadcrumbs { display: none; }

/* Cuando #subcat-header esté “stuck” le pondremos .is-stuck desde JS */
#subcat-header.is-stuck #breadcrumbs { display: block; }

/* Ajuste de scroll para que no tape summaries al anclar */
#main-content { scroll-padding-top: 88px; }           /* ≈ alto barra + breadcrumb */
#subcategoria-body details summary { scroll-margin-top: 88px; }




/* Primero quita ese margin-top en split-view */
#video-modal.split-view #toggle-thumbnails {
  position: absolute;
  top: auto;
  bottom: 0;   /* que quede justo encima del carrusel */
  left: 50%;
  transform: translateX(-50%);
  width: 5.5rem;
  height: 1.5rem;
  background-color: rgb(225, 230, 234);      /* gray-100 */
  border-radius: 0.3rem;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
}
#video-modal.split-view #toggle-thumbnails i {
  color: #475569; /* gray-600 */
  font-size: 0.75rem;
}








/* 1) Estilo para el details/summary */
#subcategoria-body details {
  border-bottom: 1px solid #e5e7eb;
}
#subcategoria-body summary {
  list-style: none; /* quita marcador por defecto */
  background-color: #f8f9fa;
  padding: 1rem 1.5rem;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
#subcategoria-body summary::-webkit-details-marker {
  display: none;
}
/* 2) Listas con viñetas */
#subcategoria-body .texto-lista ul {
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;
}
#subcategoria-body .texto-lista > ul {
  list-style: disc inside;
}
#subcategoria-body .texto-lista > ul ul {
  list-style: circle inside;
}






/* 3) Galería de imágenes con captions */
/* ===== Thumbs de IMAGEN dentro del contenido ===== */
#subcategoria-body .galeria {
  display: grid;
  gap: 8px !important;                                   /* separación entre items */
  grid-template-columns: repeat(auto-fit, minmax(70px, auto)) !important;
}

/* El <figure> aloja cuadrado + caption debajo */
#subcategoria-body .galeria .media-thumb.image-thumb{
  width: 70px !important;
  height: auto !important;
  margin: 0 !important;                                   /* el gap controla el espacio */
  display: flex !important;
  flex-direction: column !important;
  align-items: center !important;
  gap: 8px !important;                                    /* espacio entre cuadro y caption */
}

/* El CUADRADO 60×60 */
#subcategoria-body .galeria .media-thumb.image-thumb .thumb-box{
  width: 70px; 
  height: 70px;
  border-radius: .5rem;                                   /* bordes redondeados */
  overflow: hidden;                                       /* recorta sobrante */
  box-shadow: 0 1px 2px rgba(0,0,0,.06);
  background:#000;                                        /* por si hay transparencia */
}

/* La imagen rellena el cuadrado como cover */
#subcategoria-body .galeria .media-thumb.image-thumb .thumb-box img{
  width: 100% !important;
  height: 100% !important;
  object-fit: cover !important;
  display: block;
}

/* Caption debajo del cuadrado */
#subcategoria-body .galeria .media-thumb.image-thumb .thumb-caption{
  max-width: 60px;
  font-size: 6px;
  line-height: .5;
  color: #111827;
  text-align: left;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Anula reglas previas más genéricas que ponían 115×115 */
#subcategoria-body .galeria img{
  width: auto !important;
  height: auto !important;
}





#subcategoria-body .galeria figure {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
}
#subcategoria-body .galeria img {
  border-radius: 0.375rem;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  max-width: 100%;
  width: 115px;
  height: 115px;
  object-fit: cover;

}
#subcategoria-body .galeria figcaption {
  margin-top: 0.5rem;
  font-size: 0.875rem;
  color: #6b7280;
}

/* Contenedor de cada thumbnail de vídeo */
.video-thumb {
  position: relative;
  width: 8rem;    /* 128px, igual que las img de la galería */
  height: 8rem;
  flex-shrink: 0;
  border-radius: 0.375rem; /* same rounded corners */
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  margin-bottom: 2rem;
}

/*  Garantizar tamaño mínimo de todas las miniaturas  */
.media-thumb {
  min-width: 8rem;   /* ancho mínimo 128px */
  min-height: 8rem;  /* alto mínimo 128px */
}
.video-thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 0.5rem;
  border: 1px solid #d1d5db;
  box-shadow: 0 1px 2px rgba(0,0,0,0.06);
}

#video-modal .media-thumb {
  width: 60px !important;
  height: 60px !important;
  min-width: 60px !important;
  min-height: 60px !important;
}
#video-modal .media-thumb img {
  width: 60px !important;
  height: 60px !important;
  object-fit: cover;
}
/* Icono de play superpuesto */
.video-thumb .play-icon {
    position: absolute !important;
  left: 4px;
  bottom: 4px;
  width: 16px;
  height: 16px;
  border-radius: .2rem;
  background: rgba(17,24,39,.75);
  display: grid;
  place-items: center;
}
.video-thumb .play-icon i {
  font-size: 8px;
  color: #fff;
}


/* Ya tenías .video-thumb y .play-icon */

/* Para que el modal aparezca centrado y cubra todo */
#video-modal {
  position: fixed;
  inset: 0;
  z-index: 1000;
  background-color: rgba(0, 0, 0, 0.9);
  flex-direction: column;
  justify-content: stretch;
  align-items: stretch;
}

#video-modal > div {
  flex: 1;
  display: flex;
  flex-direction: row;
  width: 100%;
  height: 100%;
  overflow: visible !important;
  margin: 0; /* Asegura que no haya margen por el padding anterior */
  border-radius: 0; /* Elimina bordes redondeados */
}

/* Ajustes internos del modal */
#video-modal aside {
  /* width: 25% bg-gray-900 text-white p-6 flex flex-col */
}
#video-modal iframe {
  /* absolute inset-0 w-full h-full */
}
#modal-close {
  /* botón de cerrar en esquina */
}

/* Estilo para el modal en modo expandido */
#video-modal.expanded {
  display: flex;
  flex-direction: row;
}

#video-modal.expanded > div {
  width: 50%;
  height: 100%;
  position: relative;
}

#video-modal.expanded #main-content {
  width: 50%;
  height: 100%;
  overflow-y: auto;
  background: white;
}

#video-modal.expanded .dashboard-container {
  height: 100vh;
}

#video-modal.expanded iframe {
  height: 100% !important;
}





#video-modal.split-view {
  /* Anula inset:0 */
  position: fixed;
  z-index: 40 !important;
  top: 3rem !important; 
  right: 0 !important;
  bottom: 0 !important;
  left: 60% !important;
  width: 40% !important;
  height: calc(100% - 1rem) !important; /* 100% de la pantalla menos esos 4rem */

 background-color: transparent !important; 
}

/* Ajusta su contenedor interno para que ocupe todo */
#video-modal.split-view > div {
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  display: flex;
  flex-direction: row; /* si necesitas */
}







/* ————————————————————————
   Evita que el carrusel desborde en split-view 
   ———————————————————————— */
#video-modal.split-view .absolute.inset-x-0.top-10.bottom-0.flex {
  overflow-x: hidden !important;
  padding-bottom: 1.75rem;
}

/* Asegura que el carrusel ocupe sólo el 100% de su contenedor */
#video-modal.split-view #thumbnail-carousel {
  position: absolute;
  bottom: 0;
  left: 0; right: 0;
  
  background-color: rgb(255, 255, 255) !important;
  border-top: 1px solid #e5e7eb !important; /* border-gray-200 */
  padding: 2rem 1.5rem 0.5rem;      
             /* espacio arriba/abajo y a los lados */
  box-shadow: 0 -1px 4px rgba(0,0,0,0.05); /* ligera sombra si la quieres */
}

/* Oculta la scrollbar nativa para que no se vea el riel gris */
#video-modal.split-view #video-thumbnails {
  overflow-x: auto;
  scrollbar-width: none;    /* Firefox */
  -ms-overflow-style: none; /* IE 10+ */
}
#video-modal.split-view #video-thumbnails::-webkit-scrollbar {
  display: none;            /* Chrome, Safari */
}

/* Espaciado uniforme entre miniaturas */
#video-modal.split-view .media-thumb {
  margin: 0 2px;
}

/* Opcional: quita el backdrop sobre la mitad izquierda,
   para que el usuario pueda seguir interactuando con el contenido */
#video-modal.split-view {
  pointer-events: none;
}
/* pero que el modal y sus hijos sigan recibiendo clicks */
#video-modal.split-view > * {
  pointer-events: auto;
}

/* ——————————————— */
/* Ajuste del contenido al 50% izquierdo */
/* ——————————————— */
body.split-view-active .dashboard-container {
  position: fixed;      /* para que no se mueva */
  bottom: 0;
  left: 0;
  width: 60vw;          /* ocupa la mitad izquierda */
  overflow-y: auto;     /* scroll interno si hace falta */
}

body.split-view-active .dashboard-container aside#sidebar {
  height: 100%;         /* sidebar siempre al 100% de este contenedor */
}

body.split-view-active .dashboard-container #main-content {
  flex-grow: 1;         /* ya rellena el espacio restante del 50% */
}




/* Cuando esté en split-view, oculta la columna de descripción y haz que el vídeo ocupe todo el ancho */
#video-modal.split-view .absolute.inset-x-0.top-10.bottom-0.flex > aside {
  display: none !important;
}
#video-modal.split-view .absolute.inset-x-0.top-10.bottom-0.flex > div {
  display: flex;
    width: 100% !important;

  align-items: center;
  justify-content: center;
}

 /* Split-only: respeta el header (h-12 = 3rem) */
 #video-modal.split-view > div.absolute.inset-x-0.top-10.bottom-0 {
   top: 3rem !important;
   height: calc(100% - 3rem) !important;
 }

#video-modal.split-view button span {
  display: none !important;
}


/* Panel de descripción en split-view */
#video-modal.split-view .video-desc-panel {
  position: absolute;
  top: 3rem;    /* coincide con h-12 (3rem) de tu header */
  bottom: 0; left: 0;
  width: 240px;
  background: rgba(0,0,0,0.9);
  color: #fff;
  z-index: 80;               /* por encima del iframe */
  overflow-y: auto;
  transition: transform .3s ease;
}
/* Cuando no esté activo, lo desplazamos fuera de pantalla */
#video-modal.split-view .video-desc-panel.hidden {
  transform: translateX(-100%);
}
/* Ajustar el vídeo para dejar espacio */
/* ✅ solo desplaza el vídeo cuando el panel de descripción está abierto */
#video-modal.split-view .video-desc-panel:not(.hidden) + .absolute.inset-x-0.top-10.bottom-0.flex {
  margin-left: 240px !important;
}



/* permite a las miniaturas “salirse” un poco */
#video-modal > div.absolute.inset-x-0.top-10.bottom-0.flex {
  overflow: visible !important;
}

/* Miniaturas de imagen: altura fija y ancho auto para mantener proporciones */
#video-thumbnails .image-thumb img {
  height: 8rem;   /* mismo alto que antes (h-32) */
  width: auto;    /* ancho automático según proporción */
  object-fit: cover;
}
#video-thumbnails {
  max-width: 100%;
  overflow-x: auto;
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch; /* para scroll suave en iOS */
  scroll-behavior: smooth;
}


/* En split-view, que el fondo detrás de la imagen/vídeo sea blanco */
#video-modal.split-view .w-3\/4.relative {
  background-color: rgb(245, 246, 248) !important;
}

/* Header del modal en split-view */
#video-modal.split-view .absolute.top-0.left-0.w-full.h-12 {
  background-color: #fff !important;
  border-color: #e5e7eb !important;
  color: #000 !important;
}

/* Fondo del carrusel en split-view */







.media-thumb.selected {
  border-radius: 0.5rem;
  border: 0.3rem solid #525354;             /* gris interior */
  outline: 0.2rem solid rgba(255,255,255,0.8); /* blanco exterior */
  outline-offset: -0.2rem;                   /* sin espacio entre border y outline */
}


/* En split-view, botones transparentes y flechas grises */
#video-modal.split-view #scroll-left,
#video-modal.split-view #scroll-right {
  background-color: transparent !important;
}

#video-modal.split-view #scroll-left i,
#video-modal.split-view #scroll-right i {
  color: #6b7280 !important; /* gray-600 de Tailwind */
}


/* En modo completo (no split-view), fondo gris semitransparente en el carrusel */
#video-modal:not(.split-view) #thumbnail-carousel {
  background-color: rgba(55, 65, 81, 0.3) !important; /* gray-700 al 30% de opacidad */
}


.zoom-menu {
  position: absolute;
  top: 100%;
  right: 2rem;
  background: #1f2937;
  /* Aumentamos el padding para más espacio interior */
  padding: .75rem 1rem;     /* antes .25rem .5rem */
  /* Garantizamos un tamaño mínimo */
  min-width: 8rem;          /* 128px */
  min-height: 2.5rem;       /* 40px */
  border-radius: .375rem;
  display: flex;
  align-items: center;
  gap: .75rem;              /* antes .5rem */
  z-index: 30;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

/* Opcional: agrandar un poco los botones y el texto */
.zoom-menu button {
  font-size: 1rem;          /* antes .875rem */
  padding: .25rem .5rem;    /* un poquito más grande */
}
.zoom-menu span {
  font-size: 1.2rem;
}
.zoom-menu.hidden { display: none; }
.zoom-menu button {
  background: none;
  border: none;
  color: white;
  font-size: 1rem;
  cursor: pointer;
}
.zoom-menu span {
  color: white;
  font-size: 1rem;
  min-width: 2ch;
  text-align: center;
}


/* 1) Clippear el zoom dentro de la zona de vídeo */
#video-modal .w-3\/4.relative {
  overflow: hidden;
}

/* 2) Centrar el origen del zoom */
#modal-image {
  transform-origin: center center;
}

/* 3) Mantener la descripción siempre por encima */
#video-desc-panel {
  z-index: 30;
}


/* Split-view: descripción con fondo blanco y texto negro */
#video-modal.split-view .video-desc-panel {
  background-color: #ffffff !important;
  color: #000000 !important;
}
/* Asegúrate de que todos los elementos hijos (títulos, párrafos, etc.) hereden el color */
#video-modal.split-view .video-desc-panel h3,
#video-modal.split-view .video-desc-panel p {
  color: inherit !important;
}

/* Título en split-view: más grande y en negrita */
#video-modal.split-view .video-desc-panel h3#video-desc-title {
  font-size: 1.25rem !important;   /* aprox. 20px */
  font-weight: 700     !important; /* negrita */
  margin-bottom: 0.5rem !important; /* separa un poquito del copyright */
  display: block        !important; /* aseguramos que ocupe línea propia */
  order: -1             !important; /* si hiciera falta reposicionarlo */
}


/* estilos del footer de cada details */
.collapse-controls {
  display: none;
  padding: 0.75rem 1.5rem;
  border-top: 1px solid #e5e7eb;
  align-items: center;
  justify-content: space-between;
  background: #fff;
  font-size: 0.875rem;
  color: #475569;
}
details[open] > .collapse-controls {
  display: flex;
}
/* iconos un poco más grandes y espaciados */
.collapse-controls i {
  font-size: 0.875rem;
}
.collapse-controls span {
  font-weight: 500;
}

/* Hago sticky la barra de MY HIGHLIGHTING dentro del scroll de subcategoría */

/* Hace sticky la barra MY HIGHLIGHTING en todo el scroll de main-content */


/* 1) Asegúrate de que #main-content sea el contenedor de scroll */
#main-content {
  
  position: relative;
}






/* quita el padding-top del scroll container */
#main-content {
  /* preserve el padding horizontal si lo necesitas */
  padding: 0 2.5rem !important;
}

/* quita el margin y padding superior solo de esta sección */
#subcategoria-content {
  margin-top: 0 !important;
  padding-top: 0 !important;
  /* si quieres seguir teniendo padding a los lados y abajo: */
  padding-right: 1.5rem;
  padding-bottom: 1.5rem;
  padding-left: 1.5rem;
    background-color: #ffffff !important;

}

/* Resetea el fondo de los summary cuando el details está cerrado */
#subcategoria-body details:not([open]) > summary {
  background-color: transparent;
  min-height: 30px;
  padding: .2rem .4rem;   /* antes 1rem 1.5rem */
  line-height: .5; 
  padding-left: 1.5rem !important;
    padding-right: 1.5rem !important;

  
}

#subcategoria-body details[open] > summary {
  padding: .75rem 1.25rem;
  padding-left: 1.5rem !important;
      padding-right: 1.5rem !important;

}

/* Evita que el chevron ensanche la fila */
#subcategoria-body summary svg { flex-shrink: 0; }
.collapse-controls {
  background-color: transparent !important;
  border-top: none !important;
}

details[open] > summary {
  background-color: rgb(247, 248, 249);
}

#main-content:has(#subcategoria-content:not(.hidden)) {
  background-color: #ffffff !important;
}

/* —— Estilos finos para que se vea EXACTO —— */

.hl-title{
  font-size: 13.5px;           /* muy parecido al screenshot */
  font-weight: 600;
  letter-spacing: .02em;
  text-transform: uppercase;
  color: #475569;              /* slate-600 */
}
.hl-btn{
  padding: 2px 4px;
  color: #475569;
}
.hl-btn:hover{ color:#111827; } /* hover sutil */
.hl-sep{
  width:1px;
  height:18px;
  background:#e5e7eb;          /* gray-200 */
  margin: 0 .75rem;
  display:inline-block;
}

/* Menú de fuentes “AA” */
#lang-menu { scrollbar-width: thin; scrollbar-color: #e5e7eb transparent; }
#lang-menu::-webkit-scrollbar{ width: 8px; }
#lang-menu::-webkit-scrollbar-thumb{ background-color:#e5e7eb; border-radius:9999px; }
#lang-menu::-webkit-scrollbar-track{ background:transparent; }



/* —— Escala solo del CONTENIDO —— */
/* Variable con el porcentaje de fuente del contenido */
#subcategoria-content { --content-font-scale: 100%; }

/* Aplico la escala SOLO a texto típico del contenido */
#subcategoria-content p,
#subcategoria-content li,
#subcategoria-content figcaption,
#subcategoria-content summary span,
#subcategoria-content .texto-lista,
#subcategoria-content .collapse-controls span {
  font-size: var(--content-font-scale);
}

/* Mantengo la jerarquía de headings sin tocar el layout */
#subcategoria-content h1, 
#subcategoria-content h2, 
#subcategoria-content h3 { 
  /* opcional: si querés que también escalen, descomentá: */
  /* font-size: var(--content-font-scale); */
}


/* Líneas separadoras (hairline) más finas bajo cada título */
@supports (border-width: .5px) {
  #subcategoria-body details { border-bottom-width: .5px; }
}
@supports not (border-width: .5px) {
  /* Fallback para navegadores que no aceptan .5px */
  #subcategoria-body details {
    border-bottom: none;
    box-shadow: inset 0 -0.5px 0 0 #e5e7eb;
  }
}


/* Afinar la línea superior e inferior de la barra MY HIGHLIGHTING */
#subcat-header .highlighting-bar {
  border-top-width: .5px !important;
  border-bottom-width: .5px !important;
}


/* Base para items (enlaces y botones) */
#sidebar .sidebar-item{
  display:flex; align-items:center; height:40px;
  width:100%; text-align:left; padding:0 .75rem;
  color:#374151; /* gray-700 */
  border-radius:.375rem;
  transition:background-color .2s, color .2s, font-weight .2s;
}

/* Hover consistente */
#sidebar .sidebar-item:hover{ background:#eff6ff; } /* blue-50 */

/* — Estado activo unificado — */
#sidebar .sidebar-item.is-active{
  background:#e0f2fe;        /* blue-100 */
  color:#1d4ed8 !important;  /* blue-700 */
  font-weight:500 !important;
}
#sidebar .sidebar-item.is-active i:not(.fa-chevron-down){
  color:#1d4ed8 !important;  /* icono principal azul */
}

/* Chevrón: solo rota cuando el grupo está “abierto” */
#sidebar .sidebar-item.is-active .fa-chevron-down{
  color:#1d4ed8;
}
#sidebar .sidebar-item.chev-open .fa-chevron-down{
  transform:rotate(180deg);
}

/* Sub-items (los <a> dentro de acordeones) siguen con su tamaño menor */
#sidebar div[id^="accordion-"] a.sidebar-item{
  height:32px; font-size:.875rem; color:#6b7280;
}


/* ==== Sidebar: estado seleccionado EXACTO ==== */
/* Aplica tanto a enlaces como a botones del grupo */
#sidebar .sidebar-item.active-link,
#sidebar .sidebar-item.is-active,
#sidebar .sidebar-group > button.active-link {
  /* fondo gris */
  background-color: #f3f4f6;              /* gray-100 */
  /* texto un poco más oscuro y fuerte */
  color: #111827 !important;              /* gray-900 */
  font-weight: 600 !important;

  /* hairlines arriba/abajo (sin “engordar” el layout) */
  border-radius: 0 !important;
  border-top: .5px solid #e5e7eb;         /* gray-200 */
  border-bottom: .5px solid #e5e7eb;      /* gray-200 */

  /* banda lateral “un poco gruesa” SIN mover el contenido */
  /* usamos inset box-shadow para no alterar el ancho */
  box-shadow: inset 3px 0 0 0 #9ca3af;    /* gray-400 ~ 4px */
}

/* Icono del ítem seleccionado: que herede el color del texto */
#sidebar .sidebar-item.active-link i:not(.fa-chevron-down),
#sidebar .sidebar-item.is-active i:not(.fa-chevron-down) {
  color: inherit !important;
}

/* Hover consistente cuando ya está seleccionado (no “salta” a azul) */
#sidebar .sidebar-item.active-link:hover,
#sidebar .sidebar-item.is-active:hover {
  background-color: #f3f4f6;              /* mantiene el mismo gris */
}

/* Subitems dentro de acordeones: mantienen tipografía más pequeña
   pero heredan el look seleccionado cuando corresponda */


/* Colapsado: evitamos que la banda lateral “ensucie” el pill de iconos */
#sidebar.collapsed .sidebar-item.active-link,
#sidebar.collapsed .sidebar-item.is-active {
  box-shadow: none;
  border-top-color: transparent;
  border-bottom-color: transparent;
  background-color: transparent;
}

/* —— Botones de grupo abiertos: solo rota chevron —— */
#sidebar .sidebar-group > button.accordion-open {
  background: transparent !important;
  color: #374151 !important;          /* gray-700 */
  font-weight: 400 !important;
  border-top: none !important;
  border-bottom: none !important;
  box-shadow: none !important;
}

/* Chevron rotado */
#sidebar .sidebar-group > button.accordion-open .fa-chevron-down {
  transform: rotate(180deg);
  color: #6b7280;                      /* gray-600 */
}

/* Bloque activo */
#sidebar .sidebar-group.segment-active {
  background:#f3f4f6;
  box-shadow: inset 4px 0 0 #9ca3af;
  border-top:.5px solid #e5e7eb;
  border-bottom:.5px solid #e5e7eb;
  border-radius:0;
}
#sidebar.collapsed .sidebar-group.segment-active {
  background:transparent;
  box-shadow:none;
  border-color:transparent;
}

/* Mantener el bloque gris del grupo cuando algún subitem está activo */
#sidebar .sidebar-group:has(> div[id^="accordion-"] a.sidebar-item.is-active),
#sidebar .sidebar-group:has(> div[id^="accordion-"] a.sidebar-item.active-link) {
  background:#f3f4f6 !important;
  box-shadow: inset 4px 0 0 #9ca3af !important;
  border-top:.5px solid #e5e7eb !important;
  border-bottom:.5px solid #e5e7eb !important;
  border-radius:0 !important;
}


/* Ítems principales (Home, Drugs, etc.) */
#sidebar .sidebar-group > a.sidebar-item span,
#sidebar .sidebar-group > button .flex.items-center > span {
  font-size: 0.875rem; /* ≈14px */
}



/* Hover de SUBITEMS: texto negro, sin fondo */
#sidebar div[id^="accordion-"] a.sidebar-item:hover {
  color: #000 !important;
  background: transparent !important;
  box-shadow: none !important;
}

/* Si algún subitem tiene ícono, que acompañe el color */
#sidebar div[id^="accordion-"] a.sidebar-item:hover i {
  color: inherit !important;
}

/* Accesibilidad: al navegar con teclado, mismo look en focus */
#sidebar div[id^="accordion-"] a.sidebar-item:focus-visible {
  color: #000 !important;
  background: transparent !important;
  outline: 2px solid #d1d5db; /* opcional, quitalo si no lo querés */
  outline-offset: 2px;
}

/* Fondo gris al pasar el mouse por el grupo cuando su acordeón está abierto */
#sidebar .sidebar-group:has(> div[id^="accordion-"]:not(.hidden)):hover {
  background:#f3f4f6;               /* gris OK */
  box-shadow: none;                  /* ← quita la banda */
  border-top:.5px solid #e5e7eb;
  border-bottom:.5px solid #e5e7eb;
  border-radius:0;
}

/* Si la barra está colapsada, no pintes el hover “grande” */
#sidebar.collapsed .sidebar-group:has(> div[id^="accordion-"]:not(.hidden)):hover {
  background: transparent;
  box-shadow: none;
  border: none;
}


/* Fallback JS: mismo estilo pero con clase */
#sidebar .sidebar-group.hover-open:hover {
  background:#f3f4f6;
  box-shadow: inset 2px 0 0 #9ca3af;
  border-top:.5px solid #e5e7eb;
  border-bottom:.5px solid #e5e7eb;
  border-radius:0;
}
#sidebar.collapsed .sidebar-group.hover-open:hover {
  background: transparent;
  box-shadow: none;
  border: none;
}

/* Subitems seleccionados: sin banda, sin fondo y sin cambio de color */
#sidebar div[id^="accordion-"] a.sidebar-item.active-link,
#sidebar div[id^="accordion-"] a.sidebar-item.is-active {
  font-size: .875rem;                     /* text-sm */
  color: #111827 !important;
  box-shadow: inset 4px 0 0 0 #9ca3af;
  border-top: .5px solid #e5e7eb;
  border-bottom: .5px solid #e5e7eb;
}


/* Subitems seleccionados: texto negro, sin fondo ni banda */
#sidebar div[id^="accordion-"] a.sidebar-item.active-link,
#sidebar div[id^="accordion-"] a.sidebar-item.is-active {
  background: transparent !important;
  box-shadow: none !important;            
  border-top-color: transparent !important;
  border-bottom-color: transparent !important;
  color: #000 !important;                 
  font-weight: 500 !important;            
}


/* Subítems mucho más juntos */
#sidebar div[id^="accordion-"] a.sidebar-item {
  font-size: 0.75rem;   /* ≈12px */
  line-height: 1rem;    /* ≈16px */
  padding-top: 0.15rem; /* menos espacio arriba */
  padding-bottom: 0.15rem; /* menos espacio abajo */
  margin: 0; /* sin separación extra */
}

/* ===== Preset ultra-compacto tipo Amboss ===== */
:root{
  --subitem-font: 9px;   /* tamaño de fuente */
  --subitem-line: 22px;   /* altura total deseada por ítem */
  --subitem-vpad: 0px;    /* relleno vertical */
  --subitem-gap: 0px;     /* separación entre ítems */
}

/* Quita el espaciado vertical que añade Tailwind (space-y-1) a todos los acordeones */
#sidebar div[id^="accordion-"].space-y-1 > * + * { margin-top: var(--subitem-gap) !important; }

#sidebar div[id^="accordion-"] {
  padding-bottom: 6px; /* ajusta el valor a tu gusto */
}

/* Subitems: altura fija y muy compacta */
#sidebar div[id^="accordion-"] a.sidebar-item{
  font-size: var(--subitem-font);
  line-height: var(--subitem-line);   /* controla la altura exacta */
  padding-top: var(--subitem-vpad);
  padding-bottom: var(--subitem-vpad);
  margin: 0;                          /* sin margen extra entre ítems */
  height: var(--subitem-line);        /* asegura consistencia */
}

/* Estado seleccionado: sin banda ni bordes; texto negro y semibold */
#sidebar div[id^="accordion-"] a.sidebar-item.active-link,
#sidebar div[id^="accordion-"] a.sidebar-item.is-active{
  background: transparent !important;
  box-shadow: none !important;
  border-top-color: transparent !important;
  border-bottom-color: transparent !important;
  color: #000 !important;
  font-weight: 500 !important;
}

/* Hover sutil, sin alterar la altura */
#sidebar div[id^="accordion-"] a.sidebar-item:hover{
  background: transparent !important;
  color: #0f172a; /* slate-900 */
}

/* Quitar el espacio entre el header y el primer item de la sidebar */
#sidebar{
  padding-top: 0 !important;
}
#sidebar .sidebar-group:first-child{
  margin-top: 0 !important;
}

/* — Sangría extra para los títulos (icono más separado del borde izq.) — */
:root{ --sb-left-pad: 1.25rem; } /* prueba 1rem / 1.25rem / 1.5rem */

#sidebar .sidebar-group > a.sidebar-item,
#sidebar .sidebar-group > button.sidebar-item{
  padding-left: var(--sb-left-pad) !important;
}

/* Si en colapsado+hover también quieres esa misma sangría: */
#sidebar.collapsed:hover .sidebar-group > a.sidebar-item,
#sidebar.collapsed:hover .sidebar-group > button.sidebar-item{
  padding-left: var(--sb-left-pad) !important;
}


/* Library: que las líneas divisorias toquen los bordes de las cards */
#articles-panel .articles-panel-column > ul{
  margin-left: -1rem;   /* compensa el px-4 del contenedor */
  margin-right: -1rem;  /* idem */
}

/* Reponemos el padding en cada item para alinear con el título de la card */
#articles-panel .articles-panel-list-item{
  padding-left: 1rem !important;   /* antes 0.75rem */
  padding-right: 1rem !important;
  border-radius: 0 !important;     /* opcional: evita “islas” redondeadas al hover */
}


/* Selección en las 3 columnas de materias/temas/subtemas */
#articles-panel .articles-panel-column > ul > li.is-selected {
  background: #f3f4f6; /* gray-100 */
  box-shadow:
    inset 3px 0 0 #9ca3af,         /* banda lateral gris */
    inset 0 0.5px 0 #e5e7eb,       /* borde superior más fino */
    inset 0 -0.5px 0 #e5e7eb,      /* borde inferior más fino */
    inset -0.5px 0 0 #e5e7eb;      /* borde derecho más fino */
  border-radius: 0;
}

/* Texto un poco más oscuro y semibold */
#articles-panel .articles-panel-column > ul > li.is-selected > a {
  color:#111827;                      /* gray-900 */
  font-weight:600;
}

/* Quita la “divide line” del item actual y del siguiente */
#articles-panel .articles-panel-column > ul > li.is-selected,
#articles-panel .articles-panel-column > ul > li.is-selected + li {
  border-top-color: transparent !important;
}

/* El contenedor mantiene esquinas */
.articles-panel-column {
  border-radius: 0.5rem; /* = rounded-lg */
  overflow: hidden;      /* recorta el hover dentro de las esquinas */
  /* sombra un poco más marcada */
  box-shadow: 0 4px 12px rgba(0,0,0,0.08), 0 1px 3px rgba(0,0,0,0.06);
  transition: box-shadow .2s ease, transform .15s ease;
}

/* leve “lift” al hover */
#articles-panel .articles-panel-column:hover {
  box-shadow: 0 8px 20px rgba(0,0,0,0.12), 0 2px 6px rgba(0,0,0,0.08);
  transform: translateY(-1px);
}

/* Iconos de las listas del panel */
/* Iconos de las listas del panel */
.ap-icon{
  width: 16px; height: 16px; display: inline-block;
  background-size: contain; background-repeat: no-repeat;
  margin-right: .5rem; flex-shrink: 0;
}

/* Columnas 1 (Library) y 2 (Temas): icopanel2b / icopanel2n al seleccionar */
.ap-icon.ap2{ background-image: url('./assets/icopanel2b.png'); }
#articles-panel > .flex:first-child li.is-selected .ap-icon.ap2,
#panel-2 li.is-selected .ap-icon.ap2{
  background-image: url('./assets/icopanel2n.png');
}

/* Subtemas */
.ap-icon.ap3{ background-image: url('./assets/icopanel3.png'); }

/* ——— Más separación icono–texto SOLO en las 3 listas del panel ——— */
:root { --ap-gap: 0.95rem; } /* ~12px; súbelo/bájalo a gusto */

#articles-panel .articles-panel-list-item{
  display: flex; 
  align-items: center;
  gap: var(--ap-gap);           /* separación uniforme */
}

/* Evita “doble” separación si ya hay margin-right en los iconos */
#articles-panel .articles-panel-list-item > .ap-icon { 
  margin-right: 0 !important; 
}
#articles-panel .articles-panel-list-item > i {
  margin-right: 0 !important;
}

/* Ocultar totalmente la barra principal (sin hover-expand) */
#sidebar.force-hidden{
  width:0 !important;
  padding-left:0 !important;
  padding-right:0 !important;
  box-shadow:none !important;
}
#sidebar.force-hidden:hover{
  width:0 !important;
}

/* Anima color/fondo cuando cambia .is-active */
#subcategoria-sidebar .toc-h2{
  transition: background-color .2s ease, color .2s ease, box-shadow .2s ease;
}


/* Contenedor del TOC relativo para posicionar el indicador */
#subcategoria-sidebar .toc { position: relative; }

/* Indicador vertical a la izquierda que se desplaza */
#subcategoria-sidebar .toc-indicator{
  position: absolute; left: 0; top: 0;
  width: 3px; height: var(--h, 40px);
  background: #9ca3af;
  transform: translateY(var(--y, 0));
  transition: transform .2s ease, height .2s ease;
  border-radius: 2px;
}


/* === FULL (no split) — estilo/behaviour idéntico al split === */
#video-modal:not(.split-view) #thumbnail-carousel{
  position:absolute; bottom:0; left:0; right:0; z-index:10;
  background:#fff !important;
  border-top:1px solid #e5e7eb !important;
  padding:2rem 1.5rem .5rem;
  box-shadow:0 -1px 4px rgba(0,0,0,.05);
}
#video-modal:not(.split-view) #video-thumbnails{
  overflow-x:auto; scrollbar-width:none; -ms-overflow-style:none;
}
#video-modal:not(.split-view) #video-thumbnails::-webkit-scrollbar{ display:none; }
#video-modal:not(.split-view) .media-thumb{ margin: 0 2px;  }

#video-modal:not(.split-view) #scroll-left,
#video-modal:not(.split-view) #scroll-right{
  background:transparent !important;
}
#video-modal:not(.split-view) #scroll-left i,
#video-modal:not(.split-view) #scroll-right i{
  color:#6b7280 !important; /* gray-600 */
}

/* Botón flotante de toggle igual que en split */
 #video-modal:not(.split-view) #toggle-thumbnails{
   position:absolute; bottom: calc(env(safe-area-inset-bottom) + 8px); left:50%; transform:translateX(-50%);
  width:5.5rem; height:1.2rem; z-index:20;
  background:rgb(42, 43, 43); border-radius:.3rem;
  display:flex; align-items:center; justify-content:center;
  z-index: 100;
  
  
}

#video-modal:not(.split-view) #toggle-thumbnails i{ color: rgb(246, 247, 250) !important; ; font-size:.75rem; }

/* Evita desbordes y deja espacio inferior como en split */
#video-modal:not(.split-view) .absolute.inset-x-0.top-10.bottom-0.flex{
  overflow-x:hidden !important; padding-bottom:1.96rem;
}

/* Viewer: centra y aprovecha todo el espacio disponible */
#video-area{
  display:flex;
  align-items:center;
  justify-content:center;
}

/* Imagen a ancho/alto del área visible, respetando proporción y centrada */
#modal-image{
  width: 100% !important;
  height: calc(100% - 6rem) !important;     /* sin carrusel */
  object-fit: contain !important;
  display: block;
  margin: 0 auto;
}

/* Iframe iguala comportamiento de altura (centra por el flex del contenedor) */
#modal-iframe{
  width: 100% !important;
  height: calc(100% - 6rem) !important;     /* sin carrusel */
}

/* Cuando el carrusel está abierto, restamos más altura */





/* Modo completo: carrusel gris medio translúcido (con ligero blur opcional) */
#video-modal:not(.split-view) #thumbnail-carousel{
  backdrop-filter: blur(2px);
  background-color: rgba(41, 41, 41, 0.7) !important; /* gray-500 @ 50% */
  backdrop-filter: blur(2px);
  border-top: none !important;       /* ← quita la línea */
  box-shadow: none !important;      
}

/* Modo completo: carrusel gris translúcido SIN línea/borde superior */


/* Extra por si hay otras reglas heredadas */
#video-modal #thumbnail-carousel{ border-top: none !important; }
#video-modal #thumbnail-carousel::before{ content: none !important; }


#thumbnail-carousel #toggle-thumbnails.in-carousel{
   position: absolute;
   top: .25rem;                 /* pegado al borde superior */
   left: 50%;
   transform: translateX(-50%);
   bottom: auto !important;     /* anula el bottom previo */
   z-index: 100;
}

/* ——— Viewer fijo: imagen/iframe SIEMPRE llenan el área ——— */
#video-area { position: relative !important; }

/* La imagen y el iframe ocupan todo el alto disponible del área */
#modal-image,
#modal-iframe{
  position: absolute !important;
  inset: 0 !important;
  width: 100% !important;
  height: 100% !important;
  max-height: none !important;
  object-fit: contain !important;
  transform-origin: center center;
}

/* Carrusel superpuesto (overlay) sin empujar el contenido */
#thumbnail-carousel{
  position: absolute !important;
  left: 0; right: 0; bottom: 0;
  z-index: 30;
}

/* Botón flotante para abrir/cerrar (siempre en el mismo sitio) */
#toggle-thumbnails{
  position: absolute !important;
  left: 50% !important;
  transform: translateX(-50%) !important;
  bottom: calc(env(safe-area-inset-bottom) + 8px) !important;
  z-index: 40 !important;
}

/* Cuando el carrusel esté oculto, simplemente no se pinta */
#thumbnail-carousel.hidden{ display: none !important; }


/* ——— Split-view: carrusel translúcido ——— */
#video-modal.split-view #thumbnail-carousel{
  background-color: rgba(255,255,255,.85) !important; /* antes blanco sólido */
  border-top: 1px solid rgba(229,231,235,.7) !important;
  backdrop-filter: blur(2px);
  box-shadow: 0 -1px 6px rgba(0,0,0,.06);
}

/* ——— Split-view: toggle con el MISMO tamaño que en full ——— */
#video-modal.split-view #toggle-thumbnails{
  width: 5.5rem !important;   /* igual que full */
  height: 1.2rem !important;  /* igual que full (antes 1.5rem) */
  line-height: 1.2rem;        /* por si el icono no queda centrado */
}

/* Si el botón está dentro del carrusel (.in-carousel), mantiene el tamaño */
#video-modal.split-view #thumbnail-carousel #toggle-thumbnails.in-carousel{
  width: 5.5rem !important;
  height: 1.2rem !important;
}

/* ——— Modo video: nada debe tapar al iframe ——— */
#video-modal.video-mode #modal-image { 
  display: none !important; 
  pointer-events: none !important; 
}

#video-modal.video-mode #zoom-menu,
#video-modal.video-mode #zoom-btn {
  display: none !important;
}

#video-modal.video-mode #modal-iframe {
  pointer-events: auto !important;
}


/* Miniaturas en CONTENT (no modal) */
#subcategoria-body .galeria{
  grid-template-columns: repeat(auto-fit, 50px) !important;
  gap: 4px !important;
  justify-content: start;
}
#subcategoria-body .galeria figure{ width: 50px !important; }

#subcategoria-body .media-thumb,
#subcategoria-body .video-thumb{
  width: 50px !important;
  height: 50px !important;
  min-width: 50px !important;
  min-height: 50px !important;
  border-radius: .5rem !important;   /* bordes redondeados */
  overflow: hidden !important;
  margin: 0 !important;              /* sin márgenes extra */
  box-shadow: none;                   /* opcional: limpio */
}

/* Imágenes y thumbnails de video: siempre cover y heredando el radio */
#subcategoria-body .image-thumb img,
#subcategoria-body .video-thumb img{
  width: 100% !important;
  height: 100% !important;
  object-fit: cover !important;
  border-radius: inherit !important;
}

/* Los contenedores de videos en content se generan con gap-2 (8px):
   forzamos 4px entre miniaturas */
#subcategoria-body .flex.flex-wrap{ gap: 4px !important; }

/* Quita separación vertical extra de los videos en content */
#subcategoria-body .video-thumb{ margin-bottom: 0 !important; }


/* === Thumbs en CONTENT: 60x60, cover, cuadradas, redondeadas y gap 4px === */

/* Galería de imágenes (grid) */
#subcategoria-body .galeria{
  gap: 4px !important;
  grid-template-columns: repeat(auto-fit, minmax(60px, 60px)) !important;
}

/* Cualquier miniatura (imagen o video) dentro del contenido */
#subcategoria-body .media-thumb{
  width: 60px !important;
  height: 60px !important;
  min-width: 60px !important;
  min-height: 60px !important;
  margin: 0 !important;            /* el espaciado lo da el gap del contenedor */
  border-radius: .5rem !important; /* bordes redondeados */
  overflow: hidden !important;     /* recorta para el cover */
  box-shadow: none;                /* opcional */
}

/* Imagen interna: 60x60 y cover */
#subcategoria-body .media-thumb img{
  width: 100% !important;
  height: 100% !important;
  object-fit: cover !important;
  border-radius: .5rem !important;
  display: block;
}

/* Video thumbs en contenido (no modal) */
#subcategoria-body .video-thumb{
  width: 60px !important;
  height: 60px !important;
  min-width: 60px !important;
  min-height: 60px !important;
  margin: 0 !important;
}
#subcategoria-body .video-thumb img{
  width: 100% !important;
  height: 100% !important;
  object-fit: cover !important;
  border-radius: .5rem !important;
}

/* Si el contenedor de videos usa "flex flex-wrap gap-2", fuerza gap=4px */
#subcategoria-body details .flex.flex-wrap.gap-2 { gap: 4px !important; }

/* Por si alguna regla previa fija tamaños de galería */
#subcategoria-body .galeria img,
#subcategoria-body .image-thumb img { 
  width: 60px !important; 
  height: 60px !important; 
}



/* ======== CONTENT → Galería miniaturas 70×70 px ======== */
/* === Galería de imágenes y videos con thumbs 70x70 === */
#main-content #subcategoria-body .galeria{
  display: grid !important;
  grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)) !important;
  gap: 10px !important;
  justify-content: start !important;
}

/* Tarjeta base (imagen o video) */
#main-content #subcategoria-body .galeria .media-thumb{
  width: 70px !important;
  margin: 0 !important;
  display: flex !important;
  flex-direction: column !important;
  align-items: flex-start !important;
  gap: 4px !important;
}

/* Caja cuadrada */
#main-content #subcategoria-body .galeria .media-thumb .thumb-box{
  position: relative !important;
  width: 70px !important;
  height: 70px !important;
  border-radius: .5rem !important;
  overflow: hidden !important;
  background: #000 !important;
  box-shadow: 0 1px 2px rgba(0,0,0,.06);
}

/* Imagen interna */
#main-content #subcategoria-body .galeria .media-thumb .thumb-box img{
  width: 100% !important;
  height: 100% !important;
  object-fit: cover !important;
  display: block !important;
  border-radius: inherit !important;
}

/* Texto de descripción */
#main-content #subcategoria-body .galeria .media-thumb .thumb-caption{
  max-width: 70px !important;
  margin: 0 !important;
  font-size: 0.6rem !important;
  line-height: 0.85rem !important;
  color: #111827 !important;
  text-align: left !important;
  white-space: normal !important;
  overflow: visible !important;
  display: block !important;
}

/* — Play badge SOLO en videos — */
#main-content #subcategoria-body .galeria .media-thumb.video-thumb .play-badge{
  position: absolute !important;
  left: 4px;
  bottom: 4px;
  width: 16px;
  height: 16px;
  border-radius: .2rem;
  background: rgba(17,24,39,.75);
  display: grid;
  place-items: center;
}
#main-content #subcategoria-body .galeria .media-thumb.video-thumb .play-badge i{
  font-size: 8px;
  color: #fff;
}

/* Evita tamaños antiguos que agranden videos */
#subcategoria-body .video-thumb,
#subcategoria-body .video-thumb img{
  width: auto !important;
  height: auto !important;
  min-width: 0 !important;
  min-height: 0 !important;
}

/* Forzar Lato incluso donde se usa la clase Tailwind `font-[Inter]` */
.font-\[Inter\]{
  font-family: 'Lato', 'Lato-Regular', 'Lato-Light', ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
}

/* Tamaño base del texto en content sin zoom */
#main-content #subcategoria-body {
  font-size: 0.9rem !important;   /* antes probablemente era 1rem */
  line-height: 1.5 !important;    /* ajusta el interlineado para que no quede demasiado separado */
}

/* Split + UP: botón pegado abajo sin hueco */
#video-modal.split-view #toggle-thumbnails:not(.in-carousel){
  bottom: 0 !important;
}


/* Split + DOWN: botón arriba dentro del carrusel */
#video-modal.split-view #thumbnail-carousel #toggle-thumbnails.in-carousel{
  top: .25rem;               /* ya lo tenías, lo afirmamos aquí */
  bottom: auto !important;   /* anula cualquier bottom heredado */
}

/* Split: que el contenedor no recorte el carrusel abajo */
#video-modal.split-view .absolute.inset-x-0.top-10.bottom-0.flex{
  overflow-x: hidden !important;  /* como querías */
  overflow-y: visible !important; /* evita corte vertical */
  padding-bottom: 0 !important;   /* sin relleno que deje hueco */
}



/* 1) El modal en split debe llegar exactamente hasta abajo */
#video-modal.split-view{
  bottom: 0 !important;               /* quita el hueco */
  height: auto !important;            /* que la altura la determinen top/bottom */
  pointer-events: auto !important;    /* por si quedó deshabilitado */
  overflow: hidden !important;
  border-left: 1px solid rgba(229,231,235,.9);
}

/* 2) Botón en modo UP pegado al borde inferior (sin espacio) */
#video-modal.split-view #toggle-thumbnails:not(.in-carousel){
  position: absolute !important;
  left: 50% !important;
  transform: translateX(-50%) !important;
  bottom: 0 !important;               /* a ras del borde inferior */
  z-index: 200 !important;
}

/* 3) En modo DOWN: carrusel completo y botón arriba dentro del carrusel */
#video-modal.split-view #thumbnail-carousel{
  position: absolute !important;
  left: 0; right: 0; bottom: 0;
  padding: 2rem 1.5rem calc(.6rem + env(safe-area-inset-bottom)) !important;
  overflow: visible !important;       /* que no recorte el borde inferior */
  z-index: 150 !important;
}
#video-modal.split-view #thumbnail-carousel #toggle-thumbnails.in-carousel{
  top: .25rem !important;             /* arriba, dentro del carrusel */
  bottom: auto !important;
  z-index: 200 !important;
}

/* 4) Evitar que el contenedor intermedio recorte por abajo en split */
#video-modal.split-view .absolute.inset-x-0.top-10.bottom-0.flex,
#video-modal.split-view #video-area{
  overflow: hidden !important;
  padding-bottom: 0 !important;
}


/* ——— Menú de zoom con caret superior ——— */
.zoom-menu{
  position: absolute;
  top: calc(100% + 6px);   /* ↓ un poco más abajo */
  right: 1rem;
  background: rgb(31, 41, 55);
  color: #fff;
  padding: .3rem .6rem;   /* menos alta/ancha */
  min-width: 4rem;         /* menos ancha */
  min-height: 1.3rem;      /* menos alta */
  border-radius: .6rem;
  border: 1px solid rgba(255,255,255,.08);
  box-shadow: 0 8px 24px rgba(0,0,0,.35);
  display: flex;
  align-items: center;
  gap: .2rem;              /* compacto */
  z-index: 30;
}

/* Punta (caret) que apunta hacia arriba (sin cambios) */
.zoom-menu::after{
  content:"";
  position: absolute;
  left: var(--arrow-x, 50%);
  transform: translateX(-50%) rotate(45deg);
  top: -7px;
  width: 14px;
  height: 14px;
  background: #1f2937;
  border-left: 1px solid rgba(255,255,255,.08);
  border-top: 1px solid rgba(255,255,255,.08);
  box-shadow: -2px -2px 2px rgba(0,0,0,.08);
  pointer-events: none;
}
.zoom-menu span,
.zoom-menu button,
.zoom-menu i 
.zoom-menu .zoom-reset {

  font-size: 10px;   /* ajusta tamaño del texto e íconos */
  line-height: 1;    /* compacta la altura */
}

#video-modal.split-view .zoom-menu {
  background: #f9fafb;       /* fondo claro */
  color: rgb(31, 41, 55);            /* texto oscuro */
  
}
#video-modal.split-view .zoom-menu span,
#video-modal.split-view .zoom-menu button,
#video-modal.split-view .zoom-menu i {
  color: rgb(31, 41, 55);               /* íconos y texto oscuros */
}
#video-modal.split-view .zoom-menu::after{
  background: #f9fafb;       /* mismo color que el menú */
  border-left: none;         /* ← sin línea gris */
  border-top: none;          /* ← sin línea gris */
  box-shadow: none;  
}


.header-dark .zoom-menu{
  border-color: rgba(255,255,255,.12);
}
.header-dark .zoom-menu::after{
  border-color: rgba(255,255,255,.12);
}


/* Modal NO split: flechas del carrusel en blanco */
#video-modal:not(.split-view) #scroll-left i,
#video-modal:not(.split-view) #scroll-right i {
  color: #fff !important;            /* blanco */
  text-shadow: 0 1px 2px rgba(0,0,0,.35); /* (opcional) mejor contraste */
}


#video-modal #scroll-left,
#video-modal #scroll-right {
  top: calc(50% + 8px) !important;    /* apenas debajo del centro */
  transform: translateY(-50%) !important;
}

#video-modal.split-view #scroll-left,
#video-modal.split-view #scroll-right {
  top: calc(50% + 8px) !important;    /* menos abajo en modo split */
}

/* Footer de cada <details>: más pequeño y separado de abajo */
#subcategoria-body .collapse-controls{
  padding: .35rem .8rem;           /* más compacto */
  font-size: .6875rem;             /* ~11px */
  margin-bottom: .75rem;           /* separa un poco del borde inferior */
}

#subcategoria-body .collapse-controls button{
  gap: .2rem;                      /* menos separación icono–texto */
  padding: 0;
}

#subcategoria-body .collapse-controls i{
  font-size: .75rem;               /* iconos un poco más chicos */
}

#subcategoria-body .collapse-controls span{
  font-size: .6875rem;             /* texto aún más pequeño */
  letter-spacing: .02em;
}

/* Reduce la separación entre los dos botones de la derecha */
#subcategoria-body .collapse-controls .space-x-6 > :not([hidden]) ~ :not([hidden]){
  margin-left: .4rem !important;   /* más compacto aún */
}

/* FULL modal: un poco más de aire bajo las miniaturas del carrusel */
#video-modal:not(.split-view) #thumbnail-carousel{
  /* antes tenías .5rem; subimos un poco y respetamos el safe area en móviles */
  padding-bottom: calc(.9rem + env(safe-area-inset-bottom)) !important;
}

/* Micro-aire dentro del contenedor de thumbs (opcional) */
#video-modal:not(.split-view) #video-thumbnails{
  padding-bottom: .25rem !important;
}



/* FULL modal (no split): borde superpuesto sin cambiar el tamaño */
#video-modal:not(.split-view) .media-thumb{
  position: relative;
  overflow: hidden;
  border-radius: .4rem;
}

#video-modal:not(.split-view) .media-thumb img{
  display: block;
  width: 100% !important;
  height: 100% !important;
  object-fit: cover !important;
  border: 0 !important;
}

#video-modal:not(.split-view) .media-thumb.selected{
  border: 0 !important;
  outline: 0 !important;
}

#video-modal:not(.split-view) .media-thumb.selected::after{
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  pointer-events: none;
  box-sizing: border-box;
  box-shadow:
    inset 0 0 0 1.5px rgba(255,255,255,.85),
    inset 0 0 0 3px #525354;
}

/* SPLIT modal: mismo marco pero invertido */
#video-modal.split-view .media-thumb{
  position: relative;
  overflow: hidden;
  border-radius: .4rem;
}

#video-modal.split-view .media-thumb img{
  display: block;
  width: 100% !important;
  height: 100% !important;
  object-fit: cover !important;
  border: 0 !important;
}

#video-modal.split-view .media-thumb.selected{
  border: 0 !important;
  outline: 0 !important;
}

#video-modal.split-view .media-thumb.selected::after{
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  pointer-events: none;
  box-sizing: border-box;
  /* invertido: gris fino primero, blanco grueso afuera */
  box-shadow:
    inset 0 0 0 1.5px #525354,
    inset 0 0 0 3px rgba(255,255,255,.85);
}







/* —— FIX: split a base de variables, anulando el 60/40 ——————————— */
#video-modal.split-view{
  left: var(--split-left) !important;
  width: var(--split-w) !important;
  right: auto !important;     /* anula cualquier right:0 previo */
  height: auto !important;
}

body.split-view-active .dashboard-container{
  width: calc(var(--split-left)) !important; /* mitad izquierda real */
}

/* Sugerencia: si aún tienes algo así en tu CSS, bórralo o déjalo comentado:
#video-modal.split-view { right:0 !important; left:60% !important; width:40% !important; }
body.split-view-active .dashboard-container{ width:60vw; }
*/


#subcategoria-body .texto-lista p{margin:.5rem 0;}
#subcategoria-body .texto-lista ul{list-style:disc; margin:.5rem 0 .5rem 1.25rem;}
#subcategoria-body .texto-lista ol{list-style:decimal; margin:.5rem 0 .5rem 1.25rem;}
#subcategoria-body .texto-lista li{margin:.25rem 0;}
#subcategoria-body .texto-lista li > ul{list-style:circle; margin-top:.25rem;}
#subcategoria-body .texto-lista strong{font-weight:700;}


/* === TOC: subtítulos (h3) === */
#subcategoria-sidebar .toc-sub{ margin:.125rem 0 .25rem 0; }
#subcategoria-sidebar .toc-h3{
  width:100%;
  display:block;
  text-align:left;
  background:transparent;
  border:none;
  padding:.25rem .75rem .25rem 1.5rem; /* sangría bajo el h2 */
  font-size:.7rem;                   /* ~14px */
  color:#374151;                       /* gray-700 */
  border-radius:.375rem;
  cursor:pointer;
}
#subcategoria-sidebar .toc-h3:hover{ background:#f8fafc; }
#subcategoria-sidebar .toc-h3.is-active{
  background:transparent !important;
  color:#111827 !important;
  font-weight:500 !important;
  box-shadow: inset 3px 0 0 #9ca3af;  /* mini banda izquierda */
}


/* === TOC: resaltar CONTENEDOR cuando el activo es un h2 con subtítulos === */
#subcategoria-sidebar .toc-section{
  transition: background-color .2s ease, box-shadow .2s ease;
  border-radius:.5rem; /* redondeo normal cuando no está activo */
}
#subcategoria-sidebar .toc-section.is-active{
  background:#f3f4f6;                 /* gris suave a todo el bloque */
  border-radius:0 !important;
  box-shadow:
    inset 3px 0 0 #9ca3af,            /* banda izquierda */
    inset 0 .5px 0 #e5e7eb,           /* hairline superior */
    inset 0 -.5px 0 #e5e7eb,          /* hairline inferior */
    inset -.5px 0 0 #e5e7eb;          /* borde derecho fino */
}
#subcategoria-sidebar .toc-section.is-active .toc-h2{
  background:transparent !important;  /* evita doble fondo en el h2 */
  color:#111827;
  font-weight:500;
}

/* Subtítulo activo: solo él lleva la banda (no todo el bloque) */
#subcategoria-sidebar .toc-h3.is-active{
    border-radius: 0 !important;     /* ← quita la curva */
  background:transparent !important;
  color:#111827 !important;
  font-weight:500 !important;
  box-shadow: inset 3px 0 0 #9ca3af;
}

/* Opcional: enderezar también el contenedor cuando el activo es un h3 */
#subcategoria-sidebar .toc-section:has(.toc-h3.is-active){
  border-radius: 0 !important;
}

/* TOC: subtítulo activo con borde gris completo, igual a los títulos */
#subcategoria-sidebar .toc-h3.is-active {
  /* mismo fondo gris que los títulos activos */
  background: #f3f4f6 !important;    /* ← pisa el "transparent !important" anterior */
  color: #111827;                     /* gray-900 */
  font-weight: normal;

  /* sin radios para que “toque” los bordes */
  border-radius: 0 !important;

  /* hairlines arriba/abajo y borde derecho sutil SIN alterar layout */
  box-shadow:
    inset 2px 0 0 #9ca3af,            /* banda izquierda */
    inset 0 .5px 0 #e5e7eb,           /* borde superior */
    inset 0 -.5px 0 #e5e7eb,          /* borde inferior */
    inset -.5px 0 0 #e5e7eb;          /* borde derecho */
}


/* === Sweep celeste por DETRÁS del texto, un poco más lento === */
.flash-mark{
  position: relative;
  display: inline-block;
  z-index: 0;                 /* crea stacking context para apilar detrás */
}
.flash-mark::after{
  content: "";
  position: absolute;
  inset: 0 .06em;             /* mini margen lateral */
  background: rgba(186,230,253,.9); /* sky-200 */
  border-radius: .18em;
  pointer-events: none;

  /* detrás del texto */
  z-index: -1;                /* ← clave: queda por debajo del contenido */
  transform-origin: left center;
  transform: scaleX(0);

  /* más lento: barrido 0.8s + desvanecido 0.5s */
  animation:
    flash-sweep .9s cubic-bezier(.22,.61,.36,1) forwards,
    flash-fade  .6s ease-out .8s forwards;
}

@keyframes flash-sweep { to { transform: scaleX(1); } }
@keyframes flash-fade  { to { opacity: 0; } }























































/* Asegura que al hacer scroll el título quede justo debajo del header de 4rem */

  
  
  
  
  
  </style>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js"></script>
<script>
  // Renderer: links abren en nueva pestaña
  const mdRenderer = new marked.Renderer();
  mdRenderer.link = (href, title, text) => {
    const t = title ? ` title="${title}"` : "";
    const h = href || "#";
    return `<a href="${h}"${t} target="_blank" rel="noopener noreferrer">${text}</a>`;
  };

  function renderMD(source) {
    const src = (source ?? "").trim();
    marked.setOptions({
      gfm: true,
      breaks: true,       // respeta saltos de línea simples
      smartLists: true,
      renderer: mdRenderer
    });
    const raw = marked.parse(src);
    return DOMPurify.sanitize(raw);
  }
</script>







  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCK8SLFcVDyvLUUzVjOWOBDGHi0kD8-cKs",
      authDomain: "bancomicina-62bfe.firebaseapp.com",
      projectId: "bancomicina-62bfe",
      storageBucket: "bancomicina-62bfe.appspot.com",
      messagingSenderId: "737254665977",
      appId: "1:737254665977:web:dbafb6c16ad9d96fae7c28"
    };
    firebase.initializeApp(firebaseConfig);
    firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL);
  </script>
</head>
<body class="bg-gray-100">

<div id="login-section" class="flex flex-col items-center justify-center min-h-screen px-4 space-y-8">
  <div class="flex items-center">
    <img src="./assets/logo.png" alt="Logo" class="w-12 h-12" />
    <span class="ml-4 text-4xl font-bold text-gray-900">bancomicina</span>
  </div>
  <div class="bg-white rounded-xl shadow-lg w-full max-w-md p-8">
    <h2 class="text-2xl font-bold text-center mb-1">Bienvenido</h2>
    <p class="text-gray-500 text-center mb-6">Inicia sesión o crea una cuenta</p>
    <form id="login-form" class="space-y-4">
      <input type="email" id="email" placeholder="Email" required class="w-full px-4 py-2 bg-gray-100 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500" />
      <div class="relative">
        <input id="password" type="password" placeholder="Contraseña" required class="w-full px-4 py-2 bg-gray-100 rounded-md pr-10 focus:outline-none focus:ring-2 focus:ring-teal-500" />
        <button type="button" id="togglePassword" class="absolute inset-y-0 right-3 flex items-center text-gray-400">
          <i class="fas fa-eye"></i>
        </button>
      </div>
      <div class="space-y-2 pt-4">
        <button type="submit" class="w-full bg-teal-500 hover:bg-teal-600 text-white font-semibold py-2 rounded-md">Iniciar sesión</button>
        <button type="button" id="register-btn" class="w-full border border-teal-500 text-teal-600 font-semibold py-2 rounded-md hover:bg-teal-50">Registrarse</button>
        <button type="button" id="google-signin" class="w-full flex items-center justify-center border border-gray-300 bg-white text-gray-700 font-semibold py-2 rounded-md hover:bg-gray-50">
          <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google" class="w-5 h-5 mr-2">
          Continuar con Google
        </button>
      </div>
    </form>
  </div>
</div>

<div id="user-section" class="hidden min-h-screen w-full">
  <header class="fixed top-0 left-0 right-0 z-50 bg-white border-b flex items-center justify-between px-4 h-[3rem] shadow">
  <div class="flex items-center space-x-4">
    <button id="menu-toggle" class="text-gray-700 hover:text-black focus:outline-none">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>

    <div class="flex items-center space-x-2">
      <img src="./assets/logo.png" alt="Logo" class="w-6 h-6" />
      <span class="text-xl  text-gray-800 font-[Inter]">BANCOMICINA</span>
    </div>

    <!-- Contenedor del dropdown -->
<div class="relative" id="mode-dropdown">
  <button id="mode-btn"
    class="text-xs font-medium bg-[rgb(234,245,248)] text-[rgb(29,125,138)] px-2 py-1 rounded-full flex items-center space-x-1">
    <span id="mode-label">CLÍNICO</span>
    <i class="fas fa-chevron-down text-xs"></i>
  </button>

  <!-- Menú reducido -->
  <div id="mode-menu"
       class="hidden absolute left-0 mt-2 w-[200px] bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden z-50">
    <!-- Opción 1 -->
    <button type="button" data-mode="ESTUDIANTE"
            class="w-full text-left px-4 py-3 hover:bg-gray-50">
      <div class="text-sm font-semibold text-gray-800 leading-4">Modo Estudiante</div>
      <div class="text-xs text-gray-500 mt-0.5">Ideal para preparación de exámenes</div>
    </button>

    <!-- Opción 2 (seleccionada) -->
    <button type="button" data-mode="CLÍNICO"
            class="w-full text-left px-4 py-3 bg-gray-50 flex items-start justify-between">
      <div>
        <div class="text-sm font-semibold text-gray-800 leading-4">Modo Clínico</div>
        <div class="text-xs text-gray-500 mt-0.5">Recomendado para la práctica</div>
      </div>
      <i class="fas fa-check mt-0.5 text-[rgb(29,125,138)] text-xs"></i>
    </button>

    <div class="h-[1px] bg-gray-200"></div>

    <a href="#" class="flex items-center justify-center gap-1.5 py-2.5 text-xs font-medium text-slate-600 hover:text-slate-800">
      <i class="fas fa-info-circle text-sm"></i>
      Más información
    </a>
  </div>
</div>
  </div>

  <div class="flex items-center space-x-4">
    <button class="text-gray-600 hover:text-black">
      <i class="far fa-bookmark text-xl"></i>
    </button>
    <div id="user-initial" class="w-8 h-8 rounded-full bg-teal-600 text-white flex items-center justify-center font-semibold">
  M
</div>
  </div>
</header>

  <div class="dashboard-container">




<aside id="sidebar" class="open">
  
<!-- Home -->
  <div class="sidebar-group" id="group-home">
    <a href="#" class="sidebar-item px-3 py-2 rounded" onclick="setActiveLink(this)">
      <div class="flex items-center">
        <i class="fas fa-home w-4 shrink-0"></i>
        <span class="ml-2">Home</span>
      </div>
    </a>
  </div>

  <!-- Drugs -->
  <div class="sidebar-group" id="group-drugs">
    <a href="#" class="sidebar-item px-3 py-2 rounded" onclick="setActiveLink(this)">
      <div class="flex items-center">
        <i class="fas fa-pills w-4 shrink-0"></i>
        <span class="ml-2">Drugs</span>
      </div>
    </a>
  </div>

<!-- Clinical resources (botón + acordeón) -->
<div class="sidebar-group" id="group-clinical">
  <button onclick="toggleAccordion('clinical')"
          class="sidebar-item w-full flex items-center justify-between px-3 py-2 rounded">
    <div class="flex items-center">
      <i class="fas fa-stethoscope w-4"></i>
      <span class="ml-2">Clinical resources</span>
    </div>
    <i class="fas fa-chevron-down text-xs transition-transform duration-200"></i>
  </button>

  <div id="accordion-clinical" class="ml-8 mt-1 space-y-1 hidden">
    <a id="link-quick" href="#" class="sidebar-item block px-2 py-1 rounded"
       onclick="setActiveLink(this)">Quick Guides</a>
    <a id="link-acute" href="#" class="sidebar-item block px-2 py-1 rounded"
       onclick="setActiveLink(this)">Acute management checklists</a>
    <a id="link-flowcharts" href="#" class="sidebar-item block px-2 py-1 rounded"
       onclick="setActiveLink(this)">Flowcharts</a>
    <a id="link-calculators" href="#" class="sidebar-item block px-2 py-1 rounded"
       onclick="setActiveLink(this)">Calculators</a>
    <a href="#" class="sidebar-item block px-2 py-1 rounded"
       onclick="setActiveLink(this)">Clinical guidelines</a>
    <a href="#" class="sidebar-item block px-2 py-1 rounded"
       onclick="setActiveLink(this)">Dot Phrases</a>
  </div>
</div>

      <div class="sidebar-group" id="group-exams">
  <button onclick="toggleAccordion('exams')"
          class="sidebar-item w-full flex items-center justify-between px-3 py-2 rounded">
    <div class="flex items-center">
      <i class="fas fa-graduation-cap w-4"></i>
      <span class="ml-2">Exams & CME</span>
    </div>
    <i class="fas fa-chevron-down text-xs transition-transform duration-200"></i>
  </button>

  <div id="accordion-exams" class="ml-8 mt-1 space-y-1 hidden">
    <a href="#" class="sidebar-item block px-2 py-1 rounded" onclick="setActiveLink(this)">Qbank</a>
    <a href="#" class="sidebar-item block px-2 py-1 rounded" onclick="setActiveLink(this)">Session history</a>
    <a href="#" class="sidebar-item block px-2 py-1 rounded" onclick="setActiveLink(this)">Study plans and courses</a>
    <a href="#" class="sidebar-item block px-2 py-1 rounded" onclick="setActiveLink(this)">Study summary</a>
    <a href="#" class="sidebar-item block px-2 py-1 rounded" onclick="setActiveLink(this)">USMLE score predictor</a>
    <a href="#" class="sidebar-item block px-2 py-1 rounded" onclick="setActiveLink(this)">CME credits</a>
  </div>
</div>

      <div class="sidebar-group" id="group-library">
  <button onclick="toggleAccordion('library')"
          class="sidebar-item w-full flex items-center justify-between px-3 py-2 rounded">
    <div class="flex items-center">
      <i class="fas fa-book w-4"></i>
      <span class="ml-2">Library</span>
    </div>
    <i class="fas fa-chevron-down text-xs transition-transform duration-200"></i>
  </button>

  <div id="accordion-library" class="ml-8 mt-1 space-y-1 hidden">
    <a href="#" class="sidebar-item block px-2 py-1 rounded" onclick="setActiveLink(this)">Articles</a>
    <a href="#" class="sidebar-item block px-2 py-1 rounded" onclick="setActiveLink(this)">Videos</a>
    <a href="#" class="sidebar-item block px-2 py-1 rounded" onclick="setActiveLink(this)">Media Library</a>
  </div>
</div>

      <div class="sidebar-group" id="group-account">
  <button onclick="toggleAccordion('account')"
          class="sidebar-item w-full flex items-center justify-between px-3 py-2 rounded">
    <div class="flex items-center">
      <i class="fas fa-user-cog w-4"></i>
      <span class="ml-2">Account & settings</span>
    </div>
    <i class="fas fa-chevron-down text-xs transition-transform duration-200"></i>
  </button>

  <div id="accordion-account" class="ml-8 mt-1 space-y-1 hidden">
    <a href="#" class="sidebar-item block px-2 py-1 rounded" onclick="setActiveLink(this)">Career & study profile</a>
    <a href="#" class="sidebar-item block px-2 py-1 rounded" onclick="setActiveLink(this)">Contact details & settings</a>
    <a href="#" class="sidebar-item block px-2 py-1 rounded" onclick="setActiveLink(this)">Membership & licenses</a>
    <a href="#" class="sidebar-item block px-2 py-1 rounded" onclick="setActiveLink(this)">Invoices</a>
    <a href="#" class="sidebar-item block px-2 py-1 rounded" onclick="setActiveLink(this)">Payment info</a>
    <a href="#" class="sidebar-item block px-2 py-1 rounded" onclick="setActiveLink(this)">Redeem a code</a>
    <a href="#" class="sidebar-item block px-2 py-1 rounded" onclick="setActiveLink(this)">Activate institutional license</a>
    <a href="#" class="sidebar-item block px-2 py-1 rounded" onclick="setActiveLink(this)">Notes & more</a>
  </div>
</div>

      <div class="sidebar-group" id="group-help">
  <button onclick="toggleAccordion('help')"
          class="sidebar-item w-full flex items-center justify-between px-3 py-2 rounded">
    <div class="flex items-center">
      <i class="fas fa-question-circle w-4"></i>
      <span class="ml-2">Help & privacy</span>
    </div>
    <i class="fas fa-chevron-down text-xs transition-transform duration-200"></i>
  </button>

  <div id="accordion-help" class="ml-8 mt-1 space-y-1 hidden">
    <a href="#" class="sidebar-item block px-2 py-1 rounded" onclick="setActiveLink(this)">Help Center</a>
    <a href="#" class="sidebar-item block px-2 py-1 rounded" onclick="setActiveLink(this)">Privacy Policy</a>
    <a href="#" class="sidebar-item block px-2 py-1 rounded" onclick="setActiveLink(this)">Terms of Service</a>
  </div>
</div>
    </aside>



        <!-- Segunda sidebar para subcategorías -->
    <aside id="subcategoria-sidebar" class="hidden bg-white border-r border-gray-200 h-full overflow-y-auto">
      <div id="subcategoria-sidebar-content" class="p-4"></div>
    </aside>







<main id="main-content" class="bg-gray-100 sidebar-open">
       <div id="articles-panel" class="hidden flex-nowrap gap-x-4 transition-all mt-4">
  <!-- Columna 1: título fuera y card con la lista -->
  <div class="flex flex-col">
    <h2 class="text-lg font-bold mb-2 text-gray-800">Library</h2>
    <div class="bg-white rounded-lg shadow-sm articles-panel-column px-4 py-0">
      <ul class="text-sm divide-y divide-gray-200">
<li>
  <a href="#" onclick="showSecondPanel(this, 'Basic sciences')" class="articles-panel-list-item">
    <span class="ap-icon ap2" aria-hidden="true"></span><span>Basic sciences</span>
  </a>
</li>
      </ul>
    </div>
  </div>

  <!-- Columna 2: título fuera y card con la lista -->
  <div id="panel-2" class="flex flex-col hidden">
    <h2 class="text-lg font-bold mb-2 text-gray-800" id="second-panel-title"></h2>
    <div class="bg-white rounded-lg shadow-sm articles-panel-column px-4 py-0">
      <ul class="text-sm divide-y divide-gray-200">
<li>
  <a href="#" onclick="showThirdPanel(this, 'By discipline')" class="articles-panel-list-item">
    <span class="ap-icon ap2" aria-hidden="true"></span><span>By discipline</span>
  </a>
</li>
      </ul>
    </div>
  </div>

  <!-- Columna 3: título fuera y card con la lista -->
  <div id="panel-3" class="flex flex-col hidden">
    <h2 class="text-lg font-bold mb-2 text-gray-800" id="third-panel-title"></h2>
    <div class="bg-white rounded-lg shadow-sm articles-panel-column px-4 py-0">
      <ul class="text-sm divide-y divide-gray-200">
<li>
  <a href="#" class="articles-panel-list-item">
    <span class="ap-icon ap3" aria-hidden="true"></span>
    <span>General principles of foundational science</span>
  </a>
</li>
      </ul>
    </div>
  </div>
</div>

      <div id="home-content">
        <div class="flex justify-between items-center mb-6">
          <h1 class="text-2xl font-semibold">Welcome, <span id="user-name">Usuario</span></h1>
          <button id="logout" class="text-sm bg-red-100 text-red-600 px-3 py-1 rounded">Cerrar sesión</button>
        </div>

        <div class="flex mb-8 space-x-2 items-center">
          <select class="bg-white border rounded px-3 py-1 text-sm">
            <option>EN</option>
          </select>
          <input type="text" placeholder="Ask a clinical question" class="flex-1 border rounded px-4 py-2 text-sm" />
          <span class="px-3 py-2 text-sm text-gray-400">⌘+K</span>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="col-span-2 bg-white p-4 rounded shadow">
            <h2 class="text-lg font-semibold mb-4">Recently viewed articles</h2>
            <ul class="divide-y text-sm">
              <li class="py-2 flex items-center"><i class="fas fa-file-alt mr-2 text-gray-500"></i>Acute pancreatitis</li>
              <li class="py-2 flex items-center"><i class="fas fa-file-alt mr-2 text-gray-500"></i>Meningitis</li>
              <li class="py-2 flex items-center"><i class="fas fa-file-alt mr-2 text-gray-500"></i>Spleen</li>
              <li class="py-2 flex items-center"><i class="fas fa-file-alt mr-2 text-gray-500"></i>Fever</li>
            </ul>
          </div>
          <div class="bg-white p-4 rounded shadow border text-center">
            <div class="text-xl font-bold mb-2">NEJM Knowledge<span class="text-red-600">+</span></div>
            <p class="text-sm text-gray-600 mb-2">Board Exams and CME</p>
            <p class="text-sm text-gray-500 mb-4">Study for ABIM, ABFM, and ABP boards and earn CME credits.</p>
            <button class="px-4 py-2 text-sm text-white bg-blue-600 hover:bg-blue-700 rounded">Go to Qbank</button>
          </div>
        </div>
      </div>



<div id="subcategoria-content" class="hidden p-6 pt-10 mt-6">
  <h2 id="subcategoria-title" class="text-2xl font-bold mb-4"></h2>
  <div id="subcategoria-body" class="space-y-6"></div>
</div>










    </main>
  </div>

</div>









<script>
  const loginForm = document.getElementById("login-form");
  const emailInput = document.getElementById("email");
  const passwordInput = document.getElementById("password");
  const togglePassword = document.getElementById("togglePassword");
  const registerBtn = document.getElementById("register-btn");
  const loginSection = document.getElementById("login-section");
  const userSection = document.getElementById("user-section");
  const userName = document.getElementById("user-name");

  togglePassword.addEventListener("click", () => {
    passwordInput.type = passwordInput.type === "password" ? "text" : "password";
  });

  loginForm.addEventListener("submit", (e) => {
    e.preventDefault();
    firebase.auth().signInWithEmailAndPassword(emailInput.value, passwordInput.value)
      .catch(error => alert("Error: " + error.message));
  });

  registerBtn.addEventListener("click", () => {
    if (!emailInput.value || !passwordInput.value) {
      alert("Completa email y contraseña.");
      return;
    }
    firebase.auth().createUserWithEmailAndPassword(emailInput.value, passwordInput.value)
      .catch(error => alert("Error al registrarse: " + error.message));
  });

  document.getElementById("google-signin").addEventListener("click", () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    firebase.auth().signInWithPopup(provider).catch(error => alert("Error con Google: " + error.message));
  });

  firebase.auth().onAuthStateChanged((user) => {
    if (user) {
      loginSection.classList.add("hidden");
      userSection.classList.remove("hidden");
      userName.textContent = user.displayName?.split(" ")[0] || user.email.split("@")[0];
      const userInitial = (user.displayName?.charAt(0) || user.email.charAt(0)).toUpperCase();

      const userInitialElement = document.getElementById("user-initial");
      userInitialElement.textContent = userInitial;

      // Función para generar color en base al texto (hash)
      function stringToColor(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
          hash = str.charCodeAt(i) + ((hash << 5) - hash);
        }
        const hue = hash % 360;
        return `hsl(${hue}, 70%, 45%)`; // color agradable
      }

      // Aplica color al fondo
      const bgColor = stringToColor(user.displayName || user.email);
      userInitialElement.style.backgroundColor = bgColor;
    } else {
      loginSection.classList.remove("hidden");
      userSection.classList.add("hidden");
    }
  });

  document.getElementById("logout").addEventListener("click", () => {
    firebase.auth().signOut();
  });

  // Toggle de la sidebar
  
</script>

<script>
let STICKY_H = 0; // altura actual del header sticky

function updateStickyHeight() {
  const hdr = document.querySelector('#subcat-header');
  STICKY_H = hdr ? (hdr.getBoundingClientRect().height || 0) : 0;
}
</script>



<script>
  let currentActivePanel2Item = null; // Para mantener el elemento seleccionado en el panel 2
  let currentActivePanel3Item = null; // Para mantener el elemento seleccionado en el panel 3

  async function showSecondPanel(clickedElement, supracategoriaId) {
  const panel2 = document.getElementById("panel-2");
  const panel3 = document.getElementById("panel-3");
  const secondPanelTitle = document.getElementById("second-panel-title");

  // Reiniciar selección visual en panel 1
  // Reiniciar selección visual en panel 1
document.querySelectorAll('#articles-panel > div:first-child li')
  .forEach(li => li.classList.remove('is-selected'));
clickedElement.closest('li').classList.add('is-selected');

  // Mostrar el panel 2
  panel2.classList.remove("hidden");
  secondPanelTitle.textContent = supracategoriaId;

  // Ocultar panel 3
  panel3.classList.add("hidden");

  // Limpiar contenido anterior del panel 2
  const panel2List = panel2.querySelector("ul");
  panel2List.innerHTML = "";

  // Obtener categorías desde Firestore
  const snapshot = await db
  .collection("supracategorias")
  .doc(supracategoriaId)
  .collection("categorias")
  .orderBy("orden", "asc")
  .get();

  snapshot.forEach(doc => {
const nombreCategoria = doc.id; // usa el ID del documento como nombre visible

    const li = document.createElement("li");
    li.innerHTML = `
  <a href="#" onclick="showThirdPanel(this, '${doc.id}')" class="articles-panel-list-item">
    <span class="ap-icon ap2" aria-hidden="true"></span><span>${nombreCategoria}</span>
  </a>`;
    panel2List.appendChild(li);
  });

  // Resetear selección visual
  document.querySelectorAll('#panel-2 .articles-panel-list-item').forEach(item => {
    item.classList.remove('selected');
  });
  currentActivePanel2Item = null;
  currentActivePanel3Item = null;
}

  async function showThirdPanel(clickedElement, categoriaId) {
  const panel3 = document.getElementById("panel-3");
  const thirdPanelTitle = document.getElementById("third-panel-title");

  // Reiniciar y marcar el elemento clickeado en el panel 2
  // Reiniciar y marcar selección en panel 2
document.querySelectorAll('#panel-2 li')
  .forEach(li => li.classList.remove('is-selected'));
clickedElement.closest('li').classList.add('is-selected');
  currentActivePanel2Item = clickedElement;

  // Mostrar el panel 3
  panel3.classList.remove("hidden");
  thirdPanelTitle.textContent = categoriaId;

  // Limpiar contenido anterior
  const panel3List = panel3.querySelector("ul");
  panel3List.innerHTML = "";

  // 🔥 Obtener ID de supracategoría seleccionada (de panel 1)
// ✅ lee el <li> marcado con .is-selected
const supracategoriaId = document
  .querySelector('#articles-panel > div:first-child li.is-selected span')
  ?.textContent;
  
  if (!supracategoriaId) {
    console.error("No se encontró la supracategoría seleccionada");
    return;
  }

  // 🔥 Obtener subcategorías desde Firestore
    // 🔥 Obtener subcategorías desde Firestore, ya ordenadas por su campo "orden"
  const snapshot = await db.collection("supracategorias")
    .doc(supracategoriaId)
    .collection("categorias")
    .doc(categoriaId)
    .collection("subcategorias")
    .orderBy("orden", "asc")  // ascendente, usa "desc" si lo prefieres al revés
    .get();

  snapshot.forEach(doc => {
    const data     = doc.data();
    const nombre   = data.denominacion || doc.id;   // ojo con la e de denominación
    const li       = document.createElement("li");
    li.innerHTML = `
  <a href="#" class="articles-panel-list-item"
     onclick="markSelected(this); showSubcategoriaContent('${doc.id}','${categoriaId}','${supracategoriaId}')">
    <span class="ap-icon ap3" aria-hidden="true"></span>
    <span>${nombre}</span>
  </a>`;
    panel3List.appendChild(li);
  });

  // Reset visual
  document.querySelectorAll('#panel-3 .articles-panel-list-item').forEach(item => {
    item.classList.remove('selected');
  });
  currentActivePanel3Item = null;
}


function markSelected(el) {
  const ul = el.closest('ul');
  if (!ul) return;
  ul.querySelectorAll('li').forEach(li => li.classList.remove('is-selected'));
  el.closest('li').classList.add('is-selected');
}

async function showSubcategoriaContent(subcategoriaId, categoriaId, supracategoriaId) {
  // — Ocultar todo lo anterior —
  document.getElementById("home-content").classList.add("hidden");
  document.getElementById("articles-panel").classList.add("hidden");
  document.getElementById("panel-2").classList.add("hidden");
  document.getElementById("panel-3").classList.add("hidden");
  document.getElementById("subcategoria-content").classList.add("hidden");

  // — Referencias al DOM —
  const contentSection = document.getElementById("subcategoria-content");
  const titleEl        = document.getElementById("subcategoria-title");
  const bodyEl         = document.getElementById("subcategoria-body");

  // — Obtener datos de Firestore —
  const doc = await db
    .collection("supracategorias").doc(supracategoriaId)
    .collection("categorias").doc(categoriaId)
    .collection("subcategorias").doc(subcategoriaId)
    .get();
  if (!doc.exists) return;
  const data = doc.data();

  // — Poner título —

  // — Construir contenido en el main —
  bodyEl.innerHTML = "";
  const wrapper = document.createElement("div");
  wrapper.className = "";


  const headerHtml = `
  <!-- fila principal: dos columnas, sin padding lateral ni superior, solo padding-bottom -->
  <div class="px-6 flex justify-between items-start pb-4">
  <!-- Columna izquierda: título y botón -->
  <div class="flex flex-col space-y-3">
  <h1 class="text-3xl font-bold">
    ${data.nombre || subcategoriaId}
  </h1>
  <button class="flex items-center justify-center bg-gray-100 text-[#546E7A] text-[8px] font-semibold uppercase rounded-sm space-x-1"
        style="width:95px; height:18px;">
  <!-- Ícono triangular -->
  <svg class="w-5 h-5 fill-current" viewBox="0 0 20 20">
    <path d="M6 4l8 6-8 6V4z" />
  </svg>
  <span>Qbank Session</span>
</button>
</div>
  <!-- Columna derecha: metadata -->
  <div class="flex flex-col items-end space-y-2 text-sm">
    <span class="text-gray-500">Last edited: ${data.lastEdited || '—'}</span>
    <a href="#" class="text-blue-600 hover:underline">Content policy</a>
    <label class="inline-flex items-center space-x-1">
      <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600"/>
      <span>Learned</span>
    </label>
  </div>
</div>

<!-- solo este bloque irá dentro de #subcat-header -->
<div id="subcat-header">
  <div class="highlighting-bar -mx-20 border-y border-gray-200 bg-white z-30 relative overflow-visible">
    <!-- contenido centrado al grid del card -->
    <div class="mx-20 px-6 py-1 flex items-center justify-between overflow-visible">
      <!-- Izquierda -->
      <div class="flex items-center">
        <i class="fas fa-highlighter text-slate-600 text-sm mr-1.5"></i>
<span class="hl-title text-sm" style="font-weight:400; font-size:0.8rem;">MY HIGHLIGHTING</span>
      </div>

      <!-- Derecha -->
      <div class="flex items-center text-slate-600 space-x-1.5 relative overflow-visible">
        <button class="hl-btn" aria-label="Bookmark">
          <i class="far fa-bookmark text-sm"></i>
        </button>

        <span class="hl-sep" aria-hidden="true"></span>

        <button id="expand-all-btn" class="hl-btn" aria-label="Expand/Collapse all" type="button">
          <i class="fas fa-sort-amount-up-alt text-sm"></i>
        </button>

        <span class="hl-sep" aria-hidden="true"></span>

        <!-- “AA” más pequeño -->
        <button id="font-btn" class="hl-btn font-semibold tracking-wide text-xs">AA</button>

       <!-- Menú de zoom sobrepuestos -->
<div id="font-menu"
     class="font-menu hidden absolute right-0 top-full mt-1 z-50 inline-block rounded-l bg-white shadow-[0_8px_30px_rgba(0,0,0,0.12)]">
  <div class="grid grid-cols-[auto_auto_auto] items-center gap-2 px-3 py-2 whitespace-nowrap">
    <!-- − -->
    <button id="font-dec" aria-label="Disminuir"
            class="h-6 w-6 inline-flex items-center justify-center text-slate-600 text-l leading-none select-none">−</button>

    <!-- AA (centro / reset) -->
   <span id="font-reset" role="button" tabindex="0"
      class="justify-self-center text-slate-400 font-semibold cursor-pointer select-none leading-none transition-colors">
  AA
</span>

    <!-- + -->
    <button id="font-inc" aria-label="Aumentar"
            class="h-6 w-6 inline-flex items-center justify-center text-slate-600 text-l leading-none select-none">+</button>
  </div>
</div>

        <span class="hl-sep" aria-hidden="true"></span>
        <!-- Language dropdown -->
        <div id="lang-wrap" class="relative">
          <button id="lang-btn" class="hl-btn flex items-center" aria-haspopup="listbox" aria-expanded="false">
            <span id="lang-current" class="text-xs font-medium mr-1">EN</span>
            <i class="fas fa-chevron-down text-[9px]"></i>
          </button>
          <div id="lang-menu"
     class="hidden absolute right-0 top-full mt-2 w-56 max-h-96 overflow-y-auto
            rounded-xl border border-gray-200 bg-white
            shadow-[0_8px_30px_rgba(0,0,0,0.12)] z-50">
</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Breadcrumbs debajo en la pila -->
  <nav id="breadcrumbs" class="hidden -mx-20 bg-white border-b z-20 relative">
    <div class="mx-20 px-6 py-2 flex items-center gap-1.5 text-slate-600 text-xs leading-tight">
      <a id="bc-topic" href="#" class="hover:text-slate-800">—</a>
      <i class="fas fa-chevron-right text-[10px] text-slate-400"></i>
      <span id="bc-section" class="text-slate-800 font-medium">—</span>
    </div>
  </nav>
</div>
`;
  // Convertir el string a nodos y añadir al wrapper
  const headerNode = document.createRange().createContextualFragment(headerHtml);
  wrapper.appendChild(headerNode);

// —— Fuente “AA” (solo contenido) ——
const fontBtn   = wrapper.querySelector('#font-btn');
const fontMenu  = wrapper.querySelector('#font-menu');
const fontInc   = wrapper.querySelector('#font-inc');
const fontDec   = wrapper.querySelector('#font-dec');
const fontReset = wrapper.querySelector('#font-reset');


const contentRoot = document.getElementById('subcategoria-content');

let fontPct = 100;
const MIN = 80, MAX = 160, STEP = 5;


function updateResetVisual() {
  const isDefault = fontPct === 100;
  fontReset.classList.toggle('text-slate-400', isDefault); // gris si 100%
  fontReset.classList.toggle('text-black', !isDefault);    // negro si ≠100%
}

function applyContentFont() {
  contentRoot.style.setProperty('--content-font-scale', fontPct + '%');
  updateResetVisual();
}

// botones +/− ya llaman a applyContentFont(); si no, asegurate:
fontInc.addEventListener('click', () => { fontPct = Math.min(MAX, fontPct + STEP); applyContentFont(); });
fontDec.addEventListener('click', () => { fontPct = Math.max(MIN, fontPct - STEP); applyContentFont(); });

// reset sin cerrar menú
fontReset.addEventListener('click', () => { fontPct = 100; applyContentFont(); });
fontReset.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); fontPct = 100; applyContentFont(); }
});

fontBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  fontMenu.classList.toggle('hidden');
});

// Cerrar al clickear fuera
document.addEventListener('click', (e) => {
  if (!fontMenu.contains(e.target) && e.target !== fontBtn) {
    fontMenu.classList.add('hidden');
  }
});

fontInc.addEventListener('click', () => {
  fontPct = Math.min(MAX, fontPct + STEP);
  applyContentFont();
});

fontDec.addEventListener('click', () => {
  fontPct = Math.max(MIN, fontPct - STEP);
  applyContentFont();
});

function resetFont() {
  fontPct = 100;
  applyContentFont();
  fontMenu.classList.add('hidden'); // opcional: cerrar el menú
}

fontReset.addEventListener('click', (e) => {
  e.stopPropagation();       // evita que burbujee
  fontPct = 100;
  applyContentFont();
  // NO cerramos el menú
});

fontReset.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' || e.key === ' ') {
    e.preventDefault();
    fontPct = 100;
    applyContentFont();
  }
});

applyContentFont();
// ——— Dropdown de idioma (igual a la captura) ———
const langBtn     = wrapper.querySelector('#lang-btn');
const langMenu    = wrapper.querySelector('#lang-menu');
const langCurrent = wrapper.querySelector('#lang-current');

const LANGS = [
  { code:'ES', name:'Español' },
  { code:'AR', name:'العربية' },
  { code:'BG', name:'български' },
  { code:'CZ', name:'čeština' },
  { code:'EN', name:'English' },
  { code:'ET', name:'Eesti' },
  { code:'FA', name:'فارسی' },
  { code:'FI', name:'Suomi' },
  { code:'FR', name:'Français' },
  { code:'HR', name:'Hrvatski' },
  { code:'HU', name:'magyar' },
];

function renderLangMenu(selected) {
  langMenu.innerHTML = LANGS.map(l => `
    <button type="button" data-code="${l.code}"
      class="w-full grid grid-cols-[auto_1fr_auto] items-center gap-2 px-4 py-2.5
             hover:bg-gray-50 text-[10px] text-left">
      <span class="font-semibold text-slate-700">${l.code}</span>
      <span class="text-slate-600">(${l.name})</span>
      <i class="fas fa-check text-slate-500 ${selected===l.code ? '' : 'invisible'}"></i>
    </button>
  `).join('');
}
renderLangMenu(langCurrent.textContent.trim() || 'EN');

langBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  langMenu.classList.toggle('hidden');
  langBtn.setAttribute('aria-expanded', String(!langMenu.classList.contains('hidden')));
});

document.addEventListener('click', (e) => {
  if (!langMenu.contains(e.target) && !langBtn.contains(e.target)) {
    langMenu.classList.add('hidden');
    langBtn.setAttribute('aria-expanded', 'false');
  }
});

langMenu.addEventListener('click', (e) => {
  const item = e.target.closest('button[data-code]');
  if (!item) return;
  const code = item.dataset.code;
  // actualizar etiqueta
  langCurrent.textContent = code;
  // mover check
  langMenu.querySelectorAll('button[data-code] i').forEach(i => i.classList.add('invisible'));
  item.querySelector('i').classList.remove('invisible');
  // Hook opcional de traducción
  if (typeof setLanguage === 'function') setLanguage(code); // no cierra el menú
});



  const expandAllBtn = wrapper.querySelector('#expand-all-btn');

if (expandAllBtn) {
  expandAllBtn.addEventListener('click', () => {
    const allDetails = Array.from(wrapper.querySelectorAll('details'));
    const anyClosed = allDetails.some(d => !d.open);
    allDetails.forEach(d => d.open = anyClosed);
  });
}












  // dentro de showSubcategoriaContent, al construir cada bloque:
// 1) Extraemos las entradas y las ordenamos por bloque.orden









const sortedDefs = Object
  .entries(data.definiciondetallada || {})
  .sort(([, a], [, b]) => (a.orden ?? 0) - (b.orden ?? 0));



// ——— Helpers para renderizar la "clave" (tip con foquito) ———
const esc = (s) =>
  String(s ?? "")
    .replace(/&/g,"&amp;").replace(/</g,"&lt;")
    .replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");

// Si quieres permitir resaltar frases, escribe [[así]] en Firestore y saldrá con subrayado punteado
function formatClaveText(t){
  return esc(t).replace(/\[\[(.+?)\]\]/g,'<span class="key-dotted">$1</span>');
}

// Un “callout” azul con el ícono de foco
function renderClave(t){
  return `
  <div class="flex items-start gap-3 rounded-lg border border-blue-200 bg-blue-50 px-3 py-2 text-blue-900">
    <div class="mt-[2px] flex h-5 w-5 items-center justify-center rounded-full bg-blue-100">
      <i class="fas fa-lightbulb text-[11px] text-blue-600"></i>
    </div>
    <p class="m-0 text-sm leading-5">${formatClaveText(t)}</p>
  </div>`;
}

// Acepta bloque.clave (string) o bloque.claves (array de strings)
function renderClaveBlock(bloque){
  if (Array.isArray(bloque?.claves)) return bloque.claves.map(renderClave).join("");
  if (bloque?.clave) return renderClave(bloque.clave);
  return "";
}

// Convierte claves como "special_surface_epithelia" -> "Special Surface Epithelia"
const makeTitle = (k) => k.replace(/_/g,' ').replace(/\b\w/g, l => l.toUpperCase());

// Renderiza hijos (subsubtítulos) ordenados por "orden"
// Renderiza hijos (subsubtítulos) con look de "título" + prefijo ⤷
function renderChildren(children) {
  if (!children || typeof children !== 'object') return '';

  const childEntries = Object.entries(children)
    .sort(([,a],[,b]) => (a?.orden ?? 0) - (b?.orden ?? 0));

  return `
    <div class="divide-y divide-gray-200 -mx-6">
      ${childEntries.map(([ck, ch]) => `
        <details class="group subhead">
          <summary class="px-6 py-2 group-open:py-3 flex items-center justify-between hover:bg-slate-50 transition-colors">
            <span class="text-xs md:text-sm leading-5">
              <span aria-hidden="true" class="mr-2 text-slate-400">⤷</span>${makeTitle(ck)}
            </span>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="none" stroke="currentColor" stroke-width="2"
                 class="h-4 w-4 text-gray-500 transition-transform group-open:rotate-180" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
            </svg>
          </summary>

          <div class="px-6 py-4 text-gray-700 space-y-3">
            ${ch?.clave ? renderClave(ch.clave) : ''}

            ${ch?.texto ? `<div class="texto-lista">${renderMD(ch.texto)}</div>` : ''}

            ${Array.isArray(ch?.imagenes) && ch.imagenes.length ? `
              <div class="galeria">
                ${ch.imagenes.map(img => `
                  <figure class="media-thumb image-thumb" data-img-url="${img.url}" data-img-desc="${img.descripcion || ''}">
                    <div class="thumb-box"><img src="${img.url}" alt="${img.descripcion || ''}"></div>
                    <figcaption class="thumb-caption">${img.descripcion || ''}</figcaption>
                  </figure>
                `).join('')}
              </div>
            ` : ''}

            ${Array.isArray(ch?.videos) && ch.videos.length ? `
              <div class="galeria videos">
                ${ch.videos.map(v => `
                  <figure class="media-thumb video-thumb" data-video-id="${v.videoId}" data-video-title="${v.titulo || ''}">
                    <div class="thumb-box">
                      <img src="https://img.youtube.com/vi/${v.videoId}/hqdefault.jpg" alt="${(v.descripcion || v.titulo || 'Video').replace(/"/g,'&quot;')}" />
                      <span class="play-badge" aria-hidden="true"><i class="fas fa-play"></i></span>
                    </div>
                    <figcaption class="thumb-caption">${v.descripcion || v.titulo || ''}</figcaption>
                  </figure>
                `).join('')}
              </div>
            ` : ''}
          </div>
        </details>
      `).join('')}
    </div>
  `;
}








// 2) Iteramos en el orden correcto
sortedDefs.forEach(([key, bloque]) => {
  const title = key
    .replace(/_/g, ' ')
    .replace(/\b\w/g, l => l.toUpperCase());
  const imgs = Array.isArray(bloque.imagenes) ? bloque.imagenes : [];
  const vids = Array.isArray(bloque.videos) ? bloque.videos : [];

  const section = document.createElement("details");
  section.className = "group";
   section.innerHTML = `
  <summary class="py-2 group-open:py-3 flex items-center justify-between">
    <span class="text-xs md:text-sm leading-5 transition-[font-size] duration-150 group-open:!text-[16px] group-open:leading-[22px]">
      ${title}
    </span>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
         class="h-4 w-4 text-gray-500 transition-transform group-open:rotate-180" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
    </svg>
  </summary>

  <div class="px-6 py-4 text-gray-700 space-y-4">
    

    ${renderClaveBlock(bloque)}      <!-- 👈 NUEVO: tip con foquito si existe “clave” -->

${bloque.texto ? `<div class="texto-lista">${renderMD(bloque.texto)}</div>` : ``}

    ${imgs.length ? `
      <div class="galeria">
        ${imgs.map(img => `
          <figure class="media-thumb image-thumb" data-img-url="${img.url}" data-img-desc="${img.descripcion || ''}">
            <div class="thumb-box"><img src="${img.url}" alt="${img.descripcion || ''}"></div>
            <figcaption class="thumb-caption">${img.descripcion || ''}</figcaption>
          </figure>`).join("")}
      </div>` : ``}

    ${vids.length ? `
      <div class="galeria videos">
        ${vids.map(v => `
          <figure class="media-thumb video-thumb" data-video-id="${v.videoId}" data-video-title="${v.titulo || ''}">
            <div class="thumb-box">
              <img src="https://img.youtube.com/vi/${v.videoId}/hqdefault.jpg" alt="${(v.descripcion || v.titulo || 'Video').replace(/"/g,'&quot;')}" />
              <span class="play-badge" aria-hidden="true"><i class="fas fa-play"></i></span>
            </div>
            <figcaption class="thumb-caption">${v.descripcion || v.titulo || ''}</figcaption>
          </figure>`).join("")}
      </div>` : ``}

  
  
      </div>

  <div class="collapse-controls">
  <button class="flex items-center space-x-1">
    <i class="fas fa-grip-lines-vertical"></i>
    <span>COLLAPSE</span>
  </button>
  <div class="flex items-center space-x-6">
    <button class="flex items-center space-x-1">
      <i class="fas fa-pen"></i>
      <span>NOTES</span>
    </button>
    <button class="flex items-center space-x-1">
      <i class="fas fa-comment-dots"></i>
      <span>FEEDBACK</span>
    </button>
  </div>






</div>



  `;












  wrapper.appendChild(section);

  // —— Subsubtítulos como títulos hermanos (con prefijo ⤷) ——
if (bloque.children && typeof bloque.children === 'object') {
  const childEntries = Object.entries(bloque.children)
    .sort(([,a],[,b]) => (a?.orden ?? 0) - (b?.orden ?? 0));

  childEntries.forEach(([ck, ch]) => {
    const cImgs = Array.isArray(ch.imagenes) ? ch.imagenes : [];
    const cVids = Array.isArray(ch.videos)  ? ch.videos  : [];

    const child = document.createElement('details');
    child.className = 'group';
    child.innerHTML = `
      <summary class="py-2 group-open:py-3 flex items-center justify-between">
        <span class="text-xs md:text-sm leading-5">
          <span class="mr-2 text-slate-400">⤷</span>${makeTitle(ck)}
        </span>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
             class="h-4 w-4 text-gray-500 transition-transform group-open:rotate-180" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
        </svg>
      </summary>

      <div class="px-6 py-4 text-gray-700 space-y-4">
        ${renderClaveBlock(ch)}
        ${ch?.texto ? `<div class="texto-lista">${renderMD(ch.texto)}</div>` : ``}

        ${cImgs.length ? `
          <div class="galeria">
            ${cImgs.map(img => `
              <figure class="media-thumb image-thumb" data-img-url="${img.url}" data-img-desc="${img.descripcion || ''}">
                <div class="thumb-box"><img src="${img.url}" alt="${img.descripcion || ''}"></div>
                <figcaption class="thumb-caption">${img.descripcion || ''}</figcaption>
              </figure>`).join("")}
          </div>` : ``}

        ${cVids.length ? `
          <div class="galeria videos">
            ${cVids.map(v => `
              <figure class="media-thumb video-thumb" data-video-id="${v.videoId}" data-video-title="${v.titulo || ''}">
                <div class="thumb-box">
                  <img src="https://img.youtube.com/vi/${v.videoId}/hqdefault.jpg" alt="${(v.descripcion || v.titulo || 'Video').replace(/"/g,'&quot;')}" />
                  <span class="play-badge" aria-hidden="true"><i class="fas fa-play"></i></span>
                </div>
                <figcaption class="thumb-caption">${v.descripcion || v.titulo || ''}</figcaption>
              </figure>`).join("")}
          </div>` : ``}
      </div>

      <div class="collapse-controls">
        <button class="flex items-center space-x-1">
          <i class="fas fa-grip-lines-vertical"></i><span>COLLAPSE</span>
        </button>
        <div class="flex items-center space-x-6">
          <button class="flex items-center space-x-1"><i class="fas fa-pen"></i><span>NOTES</span></button>
          <button class="flex items-center space-x-1"><i class="fas fa-comment-dots"></i><span>FEEDBACK</span></button>
        </div>
      </div>
    `;
    wrapper.appendChild(child);
  });
}

  






});

  bodyEl.appendChild(wrapper);

    // selecciona el contenedor de scroll y tu nuevo header
  // Sentinel para detectar cuando el header se pega arriba
const content = document.getElementById('main-content');
const subcatHeader = wrapper.querySelector('#subcat-header');

// crea un sentinel justo ANTES del subcat-header
const sentinel = document.createElement('div');
sentinel.id = 'subcat-header-sentinel';
sentinel.style.height = '1px';
wrapper.insertBefore(sentinel, subcatHeader);

// observa el sentinel dentro del scroll-container (#main-content)
const io = new IntersectionObserver(
  ([entry]) => {
    // Cuando el sentinel sale por el borde superior, el header está "stuck"
    const stuck = !entry.isIntersecting;
    subcatHeader.classList.toggle('is-stuck', stuck);
    // muestra/oculta el breadcrumb sin tocar tus tamaños de summary
    const bc = subcatHeader.querySelector('#breadcrumbs');
    if (bc) bc.classList.toggle('hidden', !stuck);

    updateStickyHeight();
  },
  { root: content, threshold: 0 }
);
io.observe(sentinel);


// ——— Breadcrumb dinámico (tema > sección visible) ———
const bcTopic   = subcatHeader.querySelector('#bc-topic');
const bcSection = subcatHeader.querySelector('#bc-section');
// Tema = título de la subcategoría
bcTopic.textContent = (data.nombre || subcategoriaId);
bcTopic.addEventListener('click', (e) => {
  e.preventDefault();
  content.scrollTo({ top: 0, behavior: 'smooth' });
});
// Sección actual según el summary más alto visible
const summaries = Array.from(wrapper.querySelectorAll('#subcategoria-body details > summary'));
function updateBreadcrumbSection() {
  if (!summaries.length) return;
  const offset = subcatHeader.classList.contains('is-stuck') ? subcatHeader.offsetHeight : 0;
  const containerTop = content.getBoundingClientRect().top + offset + 1;
  let current = summaries[0];
  for (const s of summaries) {
    if (s.getBoundingClientRect().top <= containerTop) current = s; else break;
  }
  const txt = (current.querySelector('span')?.textContent || current.textContent).trim();
  bcSection.textContent = txt;
}
// también al abrir/cerrar secciones
summaries.forEach(s => s.addEventListener('click', () => setTimeout(updateBreadcrumbSection, 0)));
// estado inicial
updateBreadcrumbSection();

function getActiveTOCIndex() {
  const content = document.getElementById('main-content');
  const subcatHeader = document.querySelector('#subcat-header');
  const offset = subcatHeader?.classList.contains('is-stuck') ? subcatHeader.offsetHeight : 0;

  const summaries = Array.from(document.querySelectorAll('#subcategoria-body details > summary'));
  const containerTop = content.getBoundingClientRect().top + offset + 1;

  let current = 0;
  for (let i = 0; i < summaries.length; i++) {
    if (summaries[i].getBoundingClientRect().top <= containerTop) current = i; else break;
  }
  return current;
}

// No-op para que no rompa (luego lo mejoras si quieres animación)
function animateTOCTraversal() {/* noop */}

// —— Vincular activo de la TOC usando el contenedor cuando toca ——
function updateTOCActive(){
  const idx = getActiveTOCIndex();
  setTOCActiveByIndex(idx);
}
summaries.forEach(s => s.addEventListener('click', () => setTimeout(updateTOCActive, 0)));
updateTOCActive();



// vuelve a enlazar eventos a cada .video-thumb recién creado
wrapper.querySelectorAll('.media-thumb').forEach(thumb => {
 thumb.addEventListener('click', abrirModalMedio);
});





// — TOC: títulos (h2) + subtítulos (h3) como en la captura —
const topicTitle = (data.nombre || subcategoriaId);

// 1) Lista real de <details> en el orden en que se pintaron
const detailsList = Array.from(document.querySelectorAll('#subcategoria-body details'));

// 2) Calculamos los índices que tendrá cada botón del TOC
let cursor = 0;
const tocSections = sortedDefs.map(([k, bloque]) => {
  const h2Title = makeTitle(k);
  const h2Index = cursor++;
  const children = Object.entries(bloque.children || {})
    .sort(([,a],[,b]) => (a?.orden ?? 0) - (b?.orden ?? 0))
    .map(([ck]) => ({ title: makeTitle(ck), index: cursor++ }));
  return { title:h2Title, index:h2Index, children };
});




function flashSummaryAtIndex(idx){
  const det = detailsList[idx];
  if (!det) return;
  const summary = det.querySelector('summary');
  const target  = summary?.querySelector('span') || summary; // solo el texto, si existe
  if (!target) return;

  // reinicia la animación si ya estaba corriendo
  target.classList.remove('flash-mark');
  void target.offsetWidth;            // reflow para reiniciar
  target.classList.add('flash-mark');

  // limpia la clase al terminar
  target.addEventListener('animationend', () => {
    target.classList.remove('flash-mark');
  }, { once:true });
}

// 3) Pintamos el TOC con h2 + h3
const subSidebar = document.getElementById('subcategoria-sidebar');
const subWrap    = document.getElementById('subcategoria-sidebar-content');

let tocHTML = `
  <div class="toc-topic" id="toc-topic">${topicTitle}</div>
  <nav class="toc">
`;
tocSections.forEach(sec => {
  tocHTML += `
    <div class="toc-section">
      <button class="toc-h2" data-index="${sec.index}">${sec.title}</button>
      ${sec.children.length ? `
        <div class="toc-sub">
          ${sec.children.map(ch => `
            <button class="toc-h3" data-index="${ch.index}">${ch.title}</button>
          `).join('')}
        </div>
      ` : ``}
    </div>
  `;
});
tocHTML += `</nav>`;
subWrap.innerHTML = tocHTML;
subSidebar.classList.remove('hidden');

// —— FIX: lock de selección TOC durante scroll programático ——
let tocLockIdx = -1;
let tocLockTimer = null;
const LOCK_MS = 500; // duración aproximada del scroll suave


















// === TOC: marcar contenedor (h2+subtítulos) o solo el subtítulo ===
function setTOCActiveByIndex(activeIdx){
  const tocRoot  = document.getElementById('subcategoria-sidebar-content');
  if (!tocRoot) return;
  const h2Btns   = tocRoot.querySelectorAll('.toc-h2');
  const h3Btns   = tocRoot.querySelectorAll('.toc-h3');
  const sections = tocRoot.querySelectorAll('.toc-section');

  // limpia todo
  h2Btns.forEach(b => b.classList.remove('is-active'));
  h3Btns.forEach(b => b.classList.remove('is-active'));
  sections.forEach(s => s.classList.remove('is-active'));

  if (activeIdx == null || activeIdx < 0) return;

  const btn = tocRoot.querySelector(`[data-index="${activeIdx}"]`);
  if (!btn) return;

  if (btn.classList.contains('toc-h2')) {
    const sec = btn.closest('.toc-section');
    // si el h2 tiene subtítulos => marcar TODO el bloque; si no, marcar solo el h2 (fallback)
    if (sec && sec.querySelector('.toc-sub')) {
      sec.classList.add('is-active');
    } else {
      btn.classList.add('is-active');
    }
  } else if (btn.classList.contains('toc-h3')) {
    btn.classList.add('is-active');
  }
}



















// 4) Click: abrir la sección objetivo y hacer scroll con offset correcto
function scrollToDetailIndex(targetIdx){
  const container = document.getElementById('main-content');
  const det = detailsList[targetIdx];
  if (!det) return;
  if (!det.open) det.open = true;
  const summary = det.querySelector('summary');
  requestAnimationFrame(() => {
    const cR = container.getBoundingClientRect();
    const sR = summary.getBoundingClientRect();
    const offset = STICKY_H + 1;
    const top = container.scrollTop + (sR.top - cR.top) - offset;
    container.scrollTo({ top, behavior:'smooth' });
  });
}

// Espera hasta que el contenedor deje de desplazarse (con fallback)
function waitForScrollEnd(container, idleMs = 140, hardTimeout = 2000){
  return new Promise(resolve => {
    let idleTimer = null;
    let finished = false;

    const finish = () => {
      if (finished) return;
      finished = true;
      container.removeEventListener('scroll', onScroll, { passive:true });
      container.removeEventListener('scrollend', finish); // si existe
      clearTimeout(hardTimer);
      resolve();
    };

    const onScroll = () => {
      clearTimeout(idleTimer);
      idleTimer = setTimeout(finish, idleMs); // “no se mueve” por idleMs
    };

    // Soporte nativo si el navegador emite 'scrollend'
    container.addEventListener('scrollend', finish, { once:true });

    // Fallback por inactividad del evento scroll
    container.addEventListener('scroll', onScroll, { passive:true });
    onScroll(); // arranca el contador

    // Cortafuegos por si algo queda colgado
    const hardTimer = setTimeout(finish, hardTimeout);
  });
}


// ✅ ÚNICO handler de click
// ✅ ÚNICO handler de click (con lock anti-parpadeo)
const tocBtns = Array.from(subWrap.querySelectorAll('.toc-h2, .toc-h3'));
tocBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    const idx = Number(btn.dataset.index || -1);
    if (idx < 0) return;

    // Activa lock para evitar que el sync por scroll “robe” la selección
    if (tocLockTimer) clearTimeout(tocLockTimer);
    tocLockIdx = idx;
    setTOCActiveByIndex(idx); // pinta activo inmediatamente

    const container = document.getElementById('main-content');
    const det = detailsList[idx];
    if (!det.open) det.open = true;

    const summary = det.querySelector('summary');
    requestAnimationFrame(() => {
      const cR = container.getBoundingClientRect();
      const sR = summary.getBoundingClientRect();
      const target = container.scrollTop + (sR.top - cR.top) - STICKY_H - 1;
      container.scrollTo({ top: target, behavior: 'smooth' });
    });


        // … después de hacer container.scrollTo({ top, behavior:'smooth' });
waitForScrollEnd(container).then(() => {
  flashSummaryAtIndex(idx);   // ahora el resaltado corre cuando el scroll terminó
});


    // libera el lock cuando termina el scroll suave
    tocLockTimer = setTimeout(() => { tocLockIdx = -1; }, LOCK_MS);
  }, { passive: true });
});






// 5) Sincronizar estado activo al cargar
updateTOCActive();

  // === Sincronía TOC priorizando "abierto + contenido visible" ===
(function syncTOCByVisibility(){
  const content = document.getElementById('main-content');

  function getContainerBounds(){
    const r = content.getBoundingClientRect();
    const off = STICKY_H || 0; // respeta header/crumbs pegados (tomado del observer)
    return { top: r.top + off + 1, bottom: r.bottom };
  }

  function isVisible(el, top, bottom){
    if (!el) return false;
    const b = el.getBoundingClientRect();
    const visTop = Math.max(b.top, top);
    const visBot = Math.min(b.bottom, bottom);
    return (visBot - visTop) > 6; // umbral de 6px evita falsos positivos
  }

  function pickActiveIndex(){
  // ⛔️ Si TODO está colapsado, no seleccionar nada
  const anyOpen = detailsList.some(d => d.open);
  if (!anyOpen) return -1;

  const { top, bottom } = getContainerBounds();

  // 1) Preferir "abierto + contenido visible", y el más arriba
  let bestIdx = -1, bestY = Infinity;
  detailsList.forEach((det, idx) => {
    const sum  = det.querySelector('summary');
    const body = sum?.nextElementSibling;
    const sumVis  = isVisible(sum,  top, bottom);
    const bodyVis = det.open && isVisible(body, top, bottom);
    if (sumVis && bodyVis) {
      const y = sum.getBoundingClientRect().top;
      if (y < bestY) { bestY = y; bestIdx = idx; }
    }
  });
  if (bestIdx !== -1) return bestIdx;

  // 2) Si hay alguno abierto pero ninguno con cuerpo visible,
  //    caer al PRIMER título visible
  bestIdx = -1; bestY = Infinity;
  detailsList.forEach((det, idx) => {
    const sum = det.querySelector('summary');
    const r   = sum.getBoundingClientRect();
    const { top, bottom } = getContainerBounds();
    if (isVisible(sum, top, bottom)) {
      if (r.top < bestY) { bestY = r.top; bestIdx = idx; }
    }
  });

  return bestIdx; // puede ser -1 si no hay ninguno visible
}





function applyActive(idx){
  setTOCActiveByIndex(idx);
  // mantener auto-scroll del ítem activo en la TOC
  const activeBtn = document.querySelector(`#subcategoria-sidebar-content [data-index="${idx}"]`);
  activeBtn?.scrollIntoView({ block: 'nearest' });
}

  // Ejecuta en scroll, al abrir/cerrar <details> y al inicializar
  const onScrollSync = () => {
  if (tocLockIdx !== -1) {
    applyActive(tocLockIdx);   // mientras haya lock, mantené el activo clickeado
  } else {
    applyActive(pickActiveIndex());
  }
  updateBreadcrumbSection();
};
content.addEventListener('scroll', onScrollSync, { passive: true });
  detailsList.forEach(d => d.addEventListener('toggle', () => {
    // Espera al reflow del toggle para medir correctamente
    requestAnimationFrame(onScrollSync);
  }));
  // primer sync
  requestAnimationFrame(onScrollSync);
})();

  function setActiveTOC(idx){
    tocBtns.forEach(b=>b.classList.remove('is-active'));
    if (idx>=0 && tocBtns[idx]) tocBtns[idx].classList.add('is-active');
  }

  









  









  // — Mostrar la sección dentro del main —
  contentSection.classList.remove("hidden");

  // — Opcional: colapsar la sidebar principal si lo necesitas —
  toggleSidebarCollapse(true);
}


</script>


<script>
  let lastOpenedAccordionId = null;

// === Vista centralizada: oculta todo y muestra la sección pedida ===
function switchView(target) {
  const home  = document.getElementById("home-content");
  const art   = document.getElementById("articles-panel");
  const p2    = document.getElementById("panel-2");
  const p3    = document.getElementById("panel-3");
  const subc  = document.getElementById("subcategoria-content");
  const subSB = document.getElementById("subcategoria-sidebar");

  // Ocultar todo primero (sin parpadeos)
  home.classList.add("hidden");
  art.classList.add("hidden"); 
  art.classList.remove("flex");
  p2.classList.add("hidden");
  p3.classList.add("hidden");
  subc.classList.add("hidden");
  subSB.classList.add("hidden");

  if (target === "home") {
    home.classList.remove("hidden");
    return;
  }
  if (target === "library") {
    art.classList.remove("hidden"); 
    art.classList.add("flex");
    cargarSupracategorias(); // carga asíncrona sin bloquear el cambio de vista
    return;
  }
}

function toggleAccordion(id) {
  const acc  = document.getElementById(`accordion-${id}`);
  const btn  = acc.previousElementSibling;
  const icon = btn.querySelector('.fa-chevron-down');
  const group = btn.closest('.sidebar-group');
  const willOpen = acc.classList.contains('hidden');

  // Cierra otros acordeones y limpia clases
  document.querySelectorAll('div[id^="accordion-"]').forEach(el => {
    el.classList.add('hidden');
    const ic = el.previousElementSibling.querySelector('.fa-chevron-down');
    if (ic) ic.classList.remove('rotate-180');
    el.previousElementSibling.classList.remove('accordion-open');

    // quitar hover gris de todos los grupos
    const g = el.closest('.sidebar-group');
    g?.classList.remove('hover-open');
  });

  // Abrir/cerrar este
  if (willOpen) {
    acc.classList.remove('hidden');
    btn.classList.add('accordion-open');
    icon?.classList.add('rotate-180');
    group?.classList.add('hover-open'); // ← activa hover gris
    lastOpenedAccordionId = id;

   
   } else {
    btn.classList.remove('accordion-open');
    icon?.classList.remove('rotate-180');
    group?.classList.remove('hover-open'); // ← lo quita al cerrar
    lastOpenedAccordionId = null;
  }
}


// Función para establecer el enlace o botón activo (marcado con active-link)
function setActiveLink(element) {
  // Oculta sub-sidebar cada vez que cambias de sección
  document.getElementById("subcategoria-sidebar").classList.add("hidden");

  // Limpia bloques grises del grupo
  document.querySelectorAll('#sidebar .sidebar-group')
    .forEach(g => g.classList.remove('segment-active'));

  // Quita activos visuales de TODO
  document.querySelectorAll('#sidebar a, #sidebar button').forEach(item => {
    item.classList.remove('active-link', 'accordion-open');
    item.querySelector('.fa-chevron-down')?.classList.remove('rotate-180');
  });

  // 1) Si es BOTÓN de grupo: NO marcar activo; solo abrir acordeón y salir
  if (element.tagName === 'BUTTON' && element.closest('.sidebar-group')) {
    const acc  = element.nextElementSibling;
    const open = acc && acc.classList.contains('hidden');
    // cerrar todos los acordeones
    document.querySelectorAll('div[id^="accordion-"]').forEach(el => {
      el.classList.add('hidden');
      el.previousElementSibling.classList.remove('accordion-open');
      el.previousElementSibling.querySelector('.fa-chevron-down')?.classList.remove('rotate-180');
    });
    // abrir el propio si tocaba
    if (open) {
      acc.classList.remove('hidden');
      element.classList.add('accordion-open');
      element.querySelector('.fa-chevron-down')?.classList.add('rotate-180');
    }
    return; // <- nada de active-link aquí
  }

  // 2) Si es un ENLACE de nivel 1 (Home/Drugs), márcalo normal
  const isTopLevelLink =
    element.tagName === 'A' &&
    element.closest('.sidebar-group') &&
    !element.closest('div[id^="accordion-"]');
  if (isTopLevelLink) {
    element.classList.add('active-link');
    // cierra acordeones
    document.querySelectorAll('div[id^="accordion-"]').forEach(el => el.classList.add('hidden'));
    // Home: muestra y limpia lo demás (como ya lo tenías)
    if (element.textContent.trim() === 'Home' && element.closest('#group-home')) {
      toggleSidebarCollapse(false);
      switchView('home');
    }
    return;
  }

  // 3) Si es SUBITEM dentro de acordeón: marca el subitem y pinta el bloque
  const parentAccordionDiv = element.closest('div[id^="accordion-"]');
  if (parentAccordionDiv) {
    element.classList.add('active-link');                // subitem
    const parentButton = parentAccordionDiv.previousElementSibling;
    parentAccordionDiv.classList.remove('hidden');
    parentButton.classList.add('accordion-open');        // solo para chevron
    parentButton.querySelector('.fa-chevron-down')?.classList.add('rotate-180');
    parentButton.closest('.sidebar-group')?.classList.add('segment-active'); // bloque gris
  }

  // (tu lógica de Articles/subcategoría sigue funcionando igual)
    if (element.textContent.trim() === 'Articles' && element.closest('#group-library')) {
    switchView('library');
    // limpiar selección en las 3 columnas
    document.querySelectorAll('#articles-panel .articles-panel-list-item').forEach(i => i.classList.remove('selected'));
    currentActivePanel2Item = null;
    currentActivePanel3Item = null;
  }
}










  // Inicializar la sidebar al cargar el DOM
    document.addEventListener('DOMContentLoaded', () => {
    const thumbsContainer = document.getElementById('video-thumbnails');
    const toggleBtn       = document.getElementById('toggle-thumbnails');
      const toggleIcon      = toggleBtn.querySelector('i');
       const carousel  = document.getElementById('thumbnail-carousel');
 const videoArea = document.getElementById('video-area');



    toggleBtn.addEventListener('click', () => {
  const thumbsHidden = document.getElementById('thumbnail-carousel')
                            .classList.toggle('hidden');

        const img    = document.getElementById('modal-image');
    const iframe = document.getElementById('modal-iframe');
    [img, iframe].forEach(el => el.style.transition = 'max-height 0.1s ease');




    // 2) Cambiar la flecha
    if (thumbsHidden) {
          img.style.maxHeight    = 'calc(100% - 6rem)';
      iframe.style.maxHeight = 'calc(100% - 6rem)';
      videoArea.appendChild(toggleBtn);
  toggleBtn.classList.remove('in-carousel');
toggleBtn.style.bottom = '0';

    toggleIcon.classList.remove('fa-chevron-down');
    toggleIcon.classList.add('fa-chevron-up');
  } else {
      img.style.maxHeight    = 'calc(100% - 14rem)';
      iframe.style.maxHeight = 'calc(100% - 14rem)';
     // 80px (thumb) + 2rem (padding-top del carrusel) + .5rem (padding-bottom)
  carousel.prepend(toggleBtn);
  toggleBtn.classList.add('in-carousel');
  toggleBtn.style.bottom = '';   // lo controla el CSS de .in-carousel


    toggleIcon.classList.remove('fa-chevron-up');
    toggleIcon.classList.add('fa-chevron-down');
  }
});

     
     
      document.querySelectorAll('div[id^="accordion-"]').forEach(accordion => {
          accordion.classList.add('hidden');
          const button = accordion.previousElementSibling;
          button.classList.remove('accordion-open'); // Asegurarse de que no tenga esta clase
          const icon = button.querySelector('.fa-chevron-down');
          if (icon) {
              icon.classList.remove('rotate-180');
          }
      });

      // 2. Deseleccionar todos los enlaces y botones de grupo (asegurando limpieza total)
      document.querySelectorAll('#sidebar a, #sidebar button').forEach(item => {
          item.classList.remove('active-link');
          const itemIcon = item.querySelector('i');
          if (itemIcon) {
            itemIcon.classList.remove('text-blue-700'); // Quita el color azul de todos los iconos
            itemIcon.style.color = ''; // Restablece el color por defecto (gray-700 en este caso)
          }
      });

      // 3. Ocultar los paneles de artículos y subpaneles al inicio
      const articlesPanel = document.getElementById("articles-panel");
      articlesPanel.classList.add("hidden");
      articlesPanel.classList.remove("flex"); // Asegurarse de que no tenga flex
      document.getElementById("panel-2").classList.add("hidden");
      document.getElementById("panel-3").classList.add("hidden");

      // También, asegurarse de que no haya elementos seleccionados en los paneles de artículos
      document.querySelectorAll('#articles-panel .articles-panel-list-item').forEach(item => {
          item.classList.remove('selected');
      });
      currentActivePanel2Item = null;
      currentActivePanel3Item = null;


      // 4. Ocultar el contenido de Home al inicio (será mostrado por setActiveLink)
      document.getElementById("home-content").classList.add("hidden");

      // 5. Activar "Home" por defecto
      const homeLink = document.querySelector('#group-home a');
      if (homeLink) {
          setActiveLink(homeLink); // Esto aplicará la clase 'active-link' a "Home" y mostrará su contenido
      }
  });
</script>




<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
function toggleSidebarCollapse(force = null) {
  const sidebar = document.getElementById("sidebar");
  const mainContent = document.getElementById("main-content");

  const shouldCollapse = force !== null ? force : !sidebar.classList.contains("collapsed");

  function clearSidebarSelection() {
  // Quita cualquier estado “activo/seleccionado”
  document.querySelectorAll('#sidebar a, #sidebar button').forEach(el => {
    el.classList.remove('active-link', 'is-active', 'accordion-open');
    el.querySelector('.fa-chevron-down')?.classList.remove('rotate-180');
  });

  // Quita el bloque gris del grupo activo, si lo hubiera
  document.querySelectorAll('#sidebar .sidebar-group').forEach(g => {
    g.classList.remove('segment-active', 'hover-open');
  });
}

  if (shouldCollapse) {
    sidebar.classList.add("collapsed");
    mainContent.style.marginLeft = "0px";
    mainContent.style.width = "calc(100% - 64px)";

    // 🔽 Cierra todos los acordeones al colapsar
    document.querySelectorAll('div[id^="accordion-"]').forEach(acc => {
      acc.classList.add('hidden');
      const btn = acc.previousElementSibling;
      btn.classList.remove('accordion-open');
      const icn = btn.querySelector('.fa-chevron-down');
      if (icn) icn.classList.remove('rotate-180');
    });

    clearSidebarSelection();

  } else {
    sidebar.classList.remove("collapsed");

    document.getElementById("sidebar").addEventListener("mouseleave", () => {
  const sidebar = document.getElementById("sidebar");
  if (!sidebar.classList.contains("collapsed")) return;

  // Cierra acordeones
  document.querySelectorAll('div[id^="accordion-"]').forEach(acc => {
    acc.classList.add('hidden');
    const btn = acc.previousElementSibling;
    btn.classList.remove('accordion-open');
    btn.querySelector('.fa-chevron-down')?.classList.remove('rotate-180');
  });

  // ⬇️ Limpia cualquier selección visible/guardada
  clearSidebarSelection();
  lastOpenedAccordionId = null;
});

    // Asegura que las flechas se vuelvan a mostrar
    // ✅ Mostrar nuevamente las flechas al expandir el sidebar
document.querySelectorAll('.sidebar-group button .fa-chevron-down').forEach(icon => {
  icon.style.display = 'inline';
});

if (lastOpenedAccordionId) {
  const acc = document.getElementById(`accordion-${lastOpenedAccordionId}`);
  const btn = acc.previousElementSibling;
  acc.classList.remove('hidden');
  btn.classList.add('accordion-open');
  const icn = btn.querySelector('.fa-chevron-down');
  if (icn) icn.classList.add('rotate-180');
}

    mainContent.style.paddingLeft = "64px";
    mainContent.style.width = "100%";

    // 🔽 Cierra todos los acordeones al expandir también (opcional, ya lo tenías)
    document.querySelectorAll('div[id^="accordion-"]').forEach(acc => {
      acc.classList.add('hidden');
      const btn = acc.previousElementSibling;
      btn.classList.remove('accordion-open');
      const icn = btn.querySelector('.fa-chevron-down');
      if (icn) icn.classList.remove('rotate-180');
    });
  }
}


function toggleReadingSidebars() {
  const sidebar   = document.getElementById('sidebar');
  const subTOC    = document.getElementById('subcategoria-sidebar');
  const main      = document.getElementById('main-content');

  // ¿Estamos en el estado A (lectura)?
  const isReadingShown =
    !subTOC.classList.contains('hidden') &&
    sidebar.classList.contains('collapsed') &&
    !sidebar.classList.contains('force-hidden');

  if (isReadingShown) {
    // -> B) Ocultar ambas
    subTOC.classList.add('hidden');
    sidebar.classList.add('force-hidden');

    // Limpieza visual opcional
    document.querySelectorAll('div[id^="accordion-"]').forEach(acc => {
      acc.classList.add('hidden');
      const btn = acc.previousElementSibling;
      btn?.classList.remove('accordion-open');
      btn?.querySelector('.fa-chevron-down')?.classList.remove('rotate-180');
    });

    // El main ocupa todo
    main.style.marginLeft = '0';
    main.style.width = '100%';
    return;
  }

  // -> A) Mostrar lectura: principal colapsada + TOC visible
  sidebar.classList.remove('force-hidden');
  // Asegura "colapsada" (40px de iconos); tu función ya hace todo lo demás
  toggleSidebarCollapse(true);

  // Muestra TOC si hay contenido de subcategoría
  subTOC.classList.remove('hidden');

  // Deja que el flex haga su trabajo (sin márgenes raros)
  main.style.marginLeft = '';
  main.style.width = '';
}

/* Hook al botón del header:
   - Si hay contenido de subcategoría abierto, usa el toggle de lectura.
   - Si NO hay contenido (home, library, etc.), conserva el comportamiento actual (colapsar/expandir). */
(() => {
  const btn = document.getElementById('menu-toggle');
  const subcatContent = document.getElementById('subcategoria-content');

  const handleClick = (e) => {
    const showingSubcat = !subcatContent.classList.contains('hidden');
    if (showingSubcat) {
      toggleReadingSidebars();
    } else {
      // fallback clásico
      toggleSidebarCollapse();
    }
  };

  // Quita el listener anterior si existía y pon el nuevo
  btn.replaceWith(btn.cloneNode(true));
  const freshBtn = document.getElementById('menu-toggle');
  freshBtn.addEventListener('click', handleClick);
})();







</script>

<script>
  const db = firebase.firestore();

  async function cargarSupracategorias() {
    const panel1 = document.querySelector('#articles-panel > div:first-child ul');
    panel1.innerHTML = ""; // Limpiar contenido anterior

    const snapshot = await db.collection("supracategorias").get();
    snapshot.forEach(doc => {
   
      const nombre = doc.data().nombre;
      const li = document.createElement("li");
      li.innerHTML = `<a href="#" onclick="showSecondPanel(this, '${doc.id}')" class="articles-panel-list-item"><i class="ap-icon ap2"></i><span>${nombre}</span></a>`;
      panel1.appendChild(li);






    });
  }

  // Llamar cuando el usuario hace clic en "Articles"
  document.querySelector('#group-library a').addEventListener('click', () => {
    cargarSupracategorias();
  });



</script>







<script>
document.getElementById("sidebar").addEventListener("mouseleave", () => {
  // Solo ejecutar si está colapsado
  const sidebar = document.getElementById("sidebar");
  if (!sidebar.classList.contains("collapsed")) return;

  // Cerrar todos los acordeones
  document.querySelectorAll('div[id^="accordion-"]').forEach(acc => {
    acc.classList.add('hidden');
    const btn = acc.previousElementSibling;
    btn.classList.remove('accordion-open');
    const icn = btn.querySelector('.fa-chevron-down');
    if (icn) icn.classList.remove('rotate-180');
  });

  lastOpenedAccordionId = null;
});
</script>
</script>







<div id="video-modal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-80">

  <!-- Contenedor con posición relativa -->
  <div class="relative w-full h-full">

    <!-- Barra superior en posición absoluta -->
    <div class="absolute top-0 left-0 w-full h-12 bg-gray-800 text-white border-b border-gray-700 z-20 flex items-center justify-between px-4">
      <!-- Botón izquierdo -->
<button class="flex items-center space-x-1.5 border border-cyan-500 text-cyan-400 px-2.5 py-0.5 rounded hover:bg-cyan-900/30">
  <i class="fas fa-file-alt text-sm"></i>
  <span class="text-xs font-medium">Description</span>
</button>



<!-- Íconos derechos -->
<div class="flex items-center space-x-3 relative">
  <button class="hover:text-gray-300">
    <i class="far fa-bookmark text-sm"></i>
  </button>

  <button id="zoom-btn" class="hover:text-gray-300">
    <i class="fas fa-search-plus text-sm"></i>
  </button>

  <div id="zoom-menu" class="zoom-menu hidden">
    <button id="zoom-out">−</button>
    <span id="zoom-level">100%</span>
    <button id="zoom-in">+</button>
    <button id="zoom-reset"><i class="fas fa-redo"></i></button>
  </div>

  <button id="expand-video" class="hover:text-gray-300">
    <i class="fas fa-expand text-sm"></i>
  </button>
  <button id="modal-close" class="hover:text-gray-300" onclick="cerrarModal()">
    <i class="fas fa-times text-sm"></i>
  </button>
</div>


    </div>

      <!-- Panel de descripción oculto -->
  <!-- Panel de descripción en split-view -->
<aside id="video-desc-panel" class="video-desc-panel hidden">
  <div class="p-4 overflow-y-auto h-full">
    <!-- 1) Aquí irá el título del vídeo -->
    <h3 id="video-desc-title" class="text-lg font-semibold mb-2"></h3>
    <!-- 2) Siempre © BANCOMICINA -->
    <p id="video-desc-copyright" class="text-sm text-gray-400 mb-4">© BANCOMICINA</p>
    <!-- 3) Aquí insertaremos dinámicamente la descripción desde YouTube -->
    <p id="video-desc-text" class="text-sm text-white whitespace-pre-wrap"></p>
  </div>
</aside>






      


    </div>

    <!-- Contenido principal desplazado sólo 2rem (h-8) hacia abajo -->
    <div class="absolute inset-x-0 top-10 bottom-0 flex overflow-visible">

      <!-- Sidebar izquierdo -->
      <aside id="video-main-panel" class="w-1/4 bg-gray-900 text-white p-6 flex flex-col">
        <h2 id="modal-title" class="text-xl font-semibold mb-2">Título del vídeo</h2>
        <span class="text-sm text-gray-400">© BANCOMICINA</span>
        <p id="video-main-text" class="text-sm text-gray-200 mt-4"></p>
        
      </aside>

      <!-- Área de vídeo -->
      <div id="video-area" class="w-3/4 relative bg-black flex flex-col">
       <iframe
  id="modal-iframe"
  class="w-full"
  style="height: calc(100% - 70px);"
  src=""
  frameborder="0"
  allow="autoplay; encrypted-media"
  allowfullscreen
></iframe>

<!-- ▼ Imagen en modal: añadido para soportar imágenes -->
 <img id="modal-image" class="hidden w-full h-auto object-contain" alt="" aria-hidden="true" role="presentation"/>
        <button
  id="toggle-thumbnails"
  class="self-center z-50 w-20 h-6 flex items-center justify-center bg-gray-800 bg-opacity-75 hover:bg-opacity-100 rounded-full text-white "
>
  <i class="fas fa-chevron-up text-xs"></i>
</button>

        <!-- Carrusel con botones laterales -->
<div id="thumbnail-carousel" class="relative hidden bg-black py-4">
  <!-- Botón izquierdo -->
  <button id="scroll-left" class="absolute left-0 top-1/2 transform -translate-y-1/2 z-10 bg-black bg-opacity-30 hover:bg-opacity-60 text-white px-2 py-1 rounded-l">
    <i class="fas fa-chevron-left"></i>
  </button>

  <!-- Contenedor scrollable -->
  <div id="video-thumbnails" class="flex gap-1 overflow-x-auto scroll-smooth px-10">
    <!-- aquí se inyectan miniaturas dinámicamente -->
  </div>

  <!-- Botón derecho -->
  <button id="scroll-right" class="absolute right-0 top-1/2 transform -translate-y-1/2 z-10 bg-black bg-opacity-30 hover:bg-opacity-60 text-white px-2 py-1 rounded-r">
    <i class="fas fa-chevron-right"></i>
  </button>
</div>
    </div>
  </div>
</div>







<script>
// 1) Selecciona todas las miniaturas y el modal
const thumbs     = document.querySelectorAll('.media-thumb');
const modal      = document.getElementById('video-modal');
const imgEl      = document.getElementById('modal-image');

const iframe     = document.getElementById('modal-iframe');
const titleEl    = document.getElementById('modal-title');
const closeBtn   = document.getElementById('modal-close');

// justo después de definir `modal` y `closeBtn`
const expandBtn = document.getElementById('expand-video');
const splitDesc = document.getElementById('video-desc-panel');  // panel flotante de split
const mainDesc  = document.getElementById('video-main-panel');  // panel izquierdo de modo completo

expandBtn.addEventListener('click', e => {
  // 1) Alternamos split-view en el modal y en body
  modal.classList.toggle('split-view');
  document.body.classList.toggle('split-view-active');

  // 2) Si acabamos de entrar en split-view, ocultamos el panel de modo completo:
  if (modal.classList.contains('split-view')) {
    mainDesc.classList.add('hidden');
  } 
  // 3) Si acabamos de salir (modo completo), ocultamos el panel flotante de split:
  else {
    splitDesc.classList.add('hidden');
    // (opcional) y nos aseguramos de que el panel completo esté visible
    mainDesc.classList.remove('hidden');
  }
});


// Referencias
const descBtn   = document
  .querySelector('#video-modal button i.fa-file-alt')
  .closest('button');

// Panel flotante para split-view


descBtn.addEventListener('click', () => {
  const isSplit = modal.classList.contains('split-view');

  if (isSplit) {
    // En split-view: mostramos/ocultamos el panel flotante
    splitDesc.classList.toggle('hidden');
    return;
  }

  // En modo completo: mostramos/ocultamos el panel izquierdo
  const container = modal.querySelector('.absolute.inset-x-0.top-10.bottom-0.flex');
  const videoArea = container.querySelector('div');

  if (mainDesc.classList.contains('hidden')) {
    // Mostrar descripción → restablecemos ancho
    mainDesc.classList.remove('hidden');
    videoArea.style.width = '75%';
  } else {
    // Ocultar descripción → vídeo a ancho completo
    mainDesc.classList.add('hidden');
    videoArea.style.width = '100%';
  }
});

function resetModalLayout({ keepCarousel = false, preserveSplit = false } = {}) {
  modal.classList.remove('video-mode');

  // ← solo quita/añade split según corresponda
  if (preserveSplit) {
    modal.classList.add('split-view');
    document.body.classList.add('split-view-active');
  } else {
    modal.classList.remove('split-view');
    document.body.classList.remove('split-view-active');
  }

  document.getElementById('video-main-panel').classList.remove('hidden');
  document.getElementById('video-desc-panel').classList.add('hidden');

  const car      = document.getElementById('thumbnail-carousel');
  const btn      = document.getElementById('toggle-thumbnails');
  const ico      = btn?.querySelector('i');
  const videoArea= document.getElementById('video-area');
  const mi       = document.getElementById('modal-image');
  const iframeEl = document.getElementById('modal-iframe');

  // Estado base imagen
  mi.classList.add('hidden');
  mi.removeAttribute('src');
  mi.setAttribute('alt', '');

  if (keepCarousel && car && btn) {
    car.classList.remove('hidden');
    car.prepend(btn);
    btn.classList.add('in-carousel');
    btn.style.bottom = '';
    if (ico) { ico.classList.remove('fa-chevron-up'); ico.classList.add('fa-chevron-down'); }
    mi.style.maxHeight       = 'calc(100% - 14rem)';
    iframeEl.style.maxHeight = 'calc(100% - 14rem)';
  } else {
    if (btn && videoArea) {
      videoArea.appendChild(btn);
      btn.classList.remove('in-carousel');
      btn.style.bottom = '0';
    }
    if (ico) { ico.classList.remove('fa-chevron-down'); ico.classList.add('fa-chevron-up'); }
    if (car) car.classList.add('hidden');
    mi.style.maxHeight       = 'calc(100% - 6rem)';
    iframeEl.style.maxHeight = 'calc(100% - 6rem)';
  }
}












function abrirModalMedio(e) {
   const thumb    = e.currentTarget;
  const carousel = document.getElementById('thumbnail-carousel');

  // ¿el carrusel ya estaba abierto?
  const wasOpen   = carousel && !carousel.classList.contains('hidden');
  const firstTime = !modal.dataset.carouselEverOpened;
  modal.dataset.carouselEverOpened = '1';

  const isFromCarousel =
    !!(thumb.closest('#thumbnail-carousel') || thumb.closest('#video-thumbnails'));



      const preserveSplit = isFromCarousel && modal.classList.contains('split-view');


     resetModalLayout({
    keepCarousel: firstTime ? true : wasOpen,
    preserveSplit
  });


  scale = 1;
  pos = { x: 0, y: 0 };
  zoomLevel.textContent = '100%';
  applyTransform();
  const videoId = thumb.dataset.videoId;
  const imgUrl  = thumb.dataset.imgUrl;
  const vid   = thumb.dataset.videoId;
  const title = thumb.dataset.videoTitle || '';
  const imgDesc = thumb.dataset.imgDesc || '';




  // ① Cargamos el vídeo
if (imgUrl) {
   // ► Mostrar imagen
   modal.classList.remove('video-mode');
   iframe.src = '';                     // + detiene el vídeo
     iframe.classList.add('hidden');
      imgEl.src = imgUrl;
      imgEl.classList.remove('hidden');
      titleEl.textContent = imgDesc;

      document.getElementById('video-desc-title').textContent = imgDesc;

   zoomBtn.classList.remove('hidden');
    zoomMenu.classList.remove('hidden');
 } else {
   // ► Mostrar vídeo
   modal.classList.add('video-mode');
    imgEl.classList.add('hidden');
    imgEl.removeAttribute('src');   // evita cualquier fallback
    imgEl.setAttribute('alt','');   // sin texto alternativo
    imgEl.removeAttribute('src');   // evita que el navegador muestre el alt
    imgEl.setAttribute('alt','');   // asegura que no haya texto alternativo
   iframe.src = `https://www.youtube-nocookie.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1`;
   iframe.classList.remove('hidden');
    titleEl.textContent = title;
    document.getElementById('video-desc-title').textContent = title;


    // ocultar por completo la opción de zoom/arrastre en modo video
    zoomBtn.classList.add('hidden');
    zoomMenu.classList.add('hidden');
    // — aquí podrías reubicar tu fetch() de descripción, si lo necesitas solo para vídeo —
  }
  modal.classList.remove('hidden');



    // ———————————————
  //  A) Ponemos el título en el panel de descripción

  // B) La línea de copyright ya viene estática en el HTML
  //    (si quisieras cambiarla dinámicamente también podrías hacerlo aquí)

  // C) Recuperamos la descripción vía YouTube Data API v3
  fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${vid}&key=AIzaSyD8KPi7phPuDjEVjjsv_GyYeF3gHJO2Ygg`)
    .then(resp => resp.json())
    .then(data => {
      const desc = data.items?.[0]?.snippet?.description || 'Descripción no disponible';
      document.getElementById('video-desc-text').textContent = desc;
      const mainText = document.getElementById('video-main-text');
  mainText.textContent = desc;
    })
    .catch(err => {
      console.error('Error al cargar descripción:', err);
      document.getElementById('video-desc-text').textContent = 'No se pudo cargar la descripción.';
    });
  // ———————————————



   const thumbsContainer = document.getElementById('video-thumbnails');
  if (imgUrl) {
    // — Relaciones entre imágenes —
    const imgNodes = document.querySelectorAll('#subcategoria-body .image-thumb');
    const relatedImgs = Array.from(imgNodes)
      .map(n => ({
        url:  n.dataset.imgUrl,
        desc: n.dataset.imgDesc
      }));
    thumbsContainer.innerHTML = relatedImgs.map(img => `
      <figure class="media-thumb image-thumb" data-img-url="${img.url}" data-img-desc="${img.desc}">
        <img src="${img.url}" alt="${img.desc}" class="w-32 h-32 object-cover rounded shadow"/>
      </figure>
    `).join('');
  } else {
    // — Relaciones entre vídeos —
    const vidNodes = document.querySelectorAll('#subcategoria-body .video-thumb');
    const relatedVids = Array.from(vidNodes)
      .map(n => ({
        id:        n.dataset.videoId,
        thumbnail: n.querySelector('img').src,
        title:     n.dataset.videoTitle
      }));
    thumbsContainer.innerHTML = relatedVids.map(v => `
      <figure class="media-thumb video-thumb" data-video-id="${v.id}" data-video-title="${v.title}">
        <img src="${v.thumbnail}" alt="${v.title}" class="w-32 h-32 object-cover rounded shadow"/>
        <div class="play-icon"><i class="fas fa-play"></i></div>
      </figure>
    `).join('');


    // —> Si ninguna miniatura está marcada, marcar la primera:
if (!thumbsContainer.querySelector('.media-thumb.selected')) {
  const first = thumbsContainer.querySelector('.media-thumb');
  if (first) first.classList.add('selected');
}

    
  }
  // Re-asignar el manejador de clicks a todas las miniaturas recién inyectadas
  // Eliminar selección previa
thumbsContainer.querySelectorAll('.media-thumb').forEach(t => {
  t.classList.remove('selected');
  t.addEventListener('click', abrirModalMedio);
});

// Marcar la actual como seleccionada
setTimeout(() => {
  const allThumbs = thumbsContainer.querySelectorAll('.media-thumb');
  const selected = imgUrl
    ? Array.from(allThumbs).find(t => t.dataset.imgUrl === imgUrl)
    : Array.from(allThumbs).find(t => t.dataset.videoId === videoId);
  if (selected) selected.classList.add('selected');
}, 0);

  // ③ Volvemos a enlazar el click sobre esas miniaturas
  thumbsContainer.querySelectorAll('.media-thumb')
    .forEach(t =>{ t.addEventListener('click', abrirModalMedio);});
}





  function cerrarModal() {
  // ocultamos el modal y paramos el vídeo
  modal.classList.add('hidden');
  iframe.src = '';

  // si estábamos en split-view, lo desactivamos
  modal.classList.remove('split-view');
  document.body.classList.remove('split-view-active');

  // — opcional: si aplicaste inline styles al main, los borras —
  const main = document.getElementById('main-content');
  main.style.width = '';
  main.style.marginLeft = '';
}






  document.addEventListener('click', function(e) {
    const thumb = e.target.closest('.media-thumb');
    if (thumb) return abrirModalMedio({ currentTarget: thumb });
  });

  closeBtn.addEventListener('click', cerrarModal);
  modal.addEventListener('click', e => {
    if (e.target === modal) cerrarModal();
  });



// 2) Al hacer click en una miniatura, rellenar y mostrar modal
thumbs.forEach(thumb => {
  thumb.addEventListener('click', () => {
    const vid   = thumb.dataset.videoId;
    const title = thumb.dataset.videoTitle || '';
    iframe.src  = `https://www.youtube.com/embed/${vid}?autoplay=1`;
    titleEl.textContent = title;
    modal.classList.remove('hidden');
  });
});

// 3) Cerrar modal con la “X”
closeBtn.addEventListener('click', () => {
  modal.classList.add('hidden');
  iframe.src = '';
});



// 4) También cerrar clicando fuera del contenedor
modal.addEventListener('click', e => {
  if (e.target === modal) {
    closeBtn.click();
  }
});






document.addEventListener('DOMContentLoaded', () => {
  const thumbsContainer = document.getElementById('video-thumbnails');
  const leftBtn         = document.getElementById('scroll-left');
  const rightBtn        = document.getElementById('scroll-right');

  function selectThumb(thumb) {
scale = 1;
    pos = { x: 0, y: 0 };
    zoomLevel.textContent = '100%';
    applyTransform();



    const prev = thumbsContainer.querySelector('.media-thumb.selected');
    if (prev) prev.classList.remove('selected');
    thumb.classList.add('selected');
    abrirModalMedio({ currentTarget: thumb });
  }

  leftBtn.addEventListener('click', () => {
    const thumbs = Array.from(thumbsContainer.children);
    const idx    = thumbs.findIndex(t => t.classList.contains('selected'));
    if (idx > 0) {
      const prevThumb = thumbs[idx - 1];
      selectThumb(prevThumb);
      prevThumb.scrollIntoView({ behavior: 'smooth', inline: 'center' });
    }
  });

  rightBtn.addEventListener('click', () => {
    const thumbs = Array.from(thumbsContainer.children);
    const idx    = thumbs.findIndex(t => t.classList.contains('selected'));
    if (idx < thumbs.length - 1) {
      const nextThumb = thumbs[idx + 1];
      selectThumb(nextThumb);
      nextThumb.scrollIntoView({ behavior: 'smooth', inline: 'center' });
    }
  });
});













</script>


<script>
  const zoomBtn   = document.getElementById('zoom-btn');
  const zoomMenu  = document.getElementById('zoom-menu');
  const zoomOut   = document.getElementById('zoom-out');
  const zoomIn    = document.getElementById('zoom-in');
  const zoomReset = document.getElementById('zoom-reset');
  const zoomLevel = document.getElementById('zoom-level');
  const img       = document.getElementById('modal-image');

  // -------- Utilidad: posicionar la "punta" del menú ----------
  function placeZoomCaret() {
    // Asegura que el menú esté visible para poder medirlo
    const wasHidden = zoomMenu.classList.contains('hidden');
    if (wasHidden) zoomMenu.classList.remove('hidden');

    // Medimos rectángulos del botón y del menú
    const m = zoomMenu.getBoundingClientRect();
    const b = zoomBtn.getBoundingClientRect();

    // Centro del botón relativo al borde izquierdo del menú
    let x = (b.left + b.width / 2) - m.left;

    // Pequeño clamp para que la punta no quede pegada a los bordes
    const pad = 10;
    x = Math.max(pad, Math.min(x, m.width - pad));

    zoomMenu.style.setProperty('--arrow-x', x + 'px');

    if (wasHidden) zoomMenu.classList.add('hidden');
  }

  // -------- Estado de zoom / pan ----------
  let scale = 1;
  let pos = { x: 0, y: 0 };
  let isPanning = false;
  let start = { x: 0, y: 0 };

  img.style.transformOrigin = 'center center';
  img.style.cursor = 'grab';

  function applyTransform() {
    img.style.transform = `translate(${pos.x}px, ${pos.y}px) scale(${scale})`;
  }

  // -------- Abrir / cerrar menú ----------
  zoomBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    zoomMenu.classList.toggle('hidden');
    if (!zoomMenu.classList.contains('hidden')) {
      // Coloca la punta cuando se abre
      requestAnimationFrame(placeZoomCaret);
    }
  });

  // Cerrar al hacer click fuera
  document.addEventListener('click', (e) => {
    if (!zoomMenu.contains(e.target) && e.target !== zoomBtn) {
      zoomMenu.classList.add('hidden');
    }
  });

  // Cerrar con ESC
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') zoomMenu.classList.add('hidden');
  });

  // Recolocar la punta si cambia el layout
  window.addEventListener('resize', () => {
    if (!zoomMenu.classList.contains('hidden')) placeZoomCaret();
  });

  // -------- Controles de zoom ----------
  function setScale(next) {
    // límites 10%–300%
    scale = Math.min(3, Math.max(0.1, next));
    zoomLevel.textContent = Math.round(scale * 100) + '%';
    applyTransform();
  }

  zoomOut.addEventListener('click', () => setScale(scale - 0.1));
  zoomIn.addEventListener('click',  () => setScale(scale + 0.1));

  zoomReset.addEventListener('click', () => {
    scale = 1;
    pos = { x: 0, y: 0 };
    zoomLevel.textContent = '100%';
    applyTransform();
  });

  // -------- Panning ----------
  img.addEventListener('pointerdown', (e) => {
    e.preventDefault();
    isPanning = true;
    img.setPointerCapture?.(e.pointerId);
    img.style.cursor = 'grabbing';
    start.x = e.clientX - pos.x;
    start.y = e.clientY - pos.y;
  });

  window.addEventListener('pointermove', (e) => {
    if (!isPanning) return;
    pos.x = e.clientX - start.x;
    pos.y = e.clientY - start.y;
    applyTransform();
  });

  window.addEventListener('pointerup', (e) => {
    if (!isPanning) return;
    isPanning = false;
    img.releasePointerCapture?.(e.pointerId);
    img.style.cursor = 'grab';
  });

  // Inicial
  applyTransform();
  // (opcional) precalcula la punta por si el menú arranca abierto
  if (!zoomMenu.classList.contains('hidden')) placeZoomCaret();
</script>

<script>
// Delegación de evento: si haces click en cualquier botón dentro de .collapse-controls…
document.addEventListener('click', function(e) {
  const btn = e.target.closest('.collapse-controls > button');
  if (!btn) return;

  // Busca el <details> más cercano y ciérralo
  const detail = btn.closest('details');
  if (detail) detail.removeAttribute('open');
});
</script>


<script>
  // --- Dropdown comportamiento ---
  (() => {
    const wrap = document.getElementById('mode-dropdown');
    const btn  = document.getElementById('mode-btn');
    const lab  = document.getElementById('mode-label');
    const menu = document.getElementById('mode-menu');

    // abrir/cerrar
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      menu.classList.toggle('hidden');
    });

    // cerrar al clic fuera
    document.addEventListener('click', (e) => {
      if (!wrap.contains(e.target)) menu.classList.add('hidden');
    });

    // seleccionar opción
    menu.addEventListener('click', (e) => {
      const opt = e.target.closest('button[data-mode]');
      if (!opt) return;

      const mode = opt.getAttribute('data-mode');
      lab.textContent = mode;

      menu.querySelectorAll('button[data-mode]').forEach(b => {
        b.classList.remove('bg-gray-50');
        const check = b.querySelector('.fa-check');
        if (check) check.remove();
      });
      opt.classList.add('bg-gray-50');
      if (!opt.querySelector('.fa-check')) {
        opt.insertAdjacentHTML('beforeend', '<i class="fas fa-check mt-1 text-[rgb(29,125,138)]"></i>');
      }

      menu.classList.add('hidden');
    });
  })();
</script>

<script>
// Mantener split-view al hacer click en miniaturas del carrusel
(function keepSplitOnCarouselThumbs(){
  const root =
    document.getElementById('video-thumbnails') ||
    document.querySelector('#thumbnail-carousel');

  if (!root) return;

  // Delegación: escucha clicks en las miniaturas del carrusel
  root.addEventListener('click', (e) => {
    const thumb = e.target.closest('.media-thumb');
    if (!thumb) return;

    const modal = document.getElementById('video-modal');
    if (!modal || !modal.classList.contains('split-view')) return; // solo si ya estaba en split

    // Deja que el handler actual haga su trabajo y luego re-aplica split
    requestAnimationFrame(() => {
      modal.classList.add('split-view');
      document.body.classList.add('split-view-active');
    });
    // Reafirma una vez más por si hay lógica asíncrona
    setTimeout(() => {
      modal.classList.add('split-view');
      document.body.classList.add('split-view-active');
    }, 0);
  });
})();
</script>




<script>
(function(){
  function val(rootVar, fallback){
    const v = parseFloat(getComputedStyle(document.documentElement).getPropertyValue(rootVar));
    return Number.isFinite(v) ? v : fallback;
  }

  function computeSplit(){
    const modal = document.getElementById('video-modal');
    if (!modal || !modal.classList.contains('split-view')) return;

    const sb  = document.getElementById('sidebar');
    const toc = document.getElementById('subcategoria-sidebar');

    // ancho sidebar principal según estado
    let sbW = 0;
    if (sb) {
      if (sb.classList.contains('force-hidden')) {
        sbW = 0;
      } else if (sb.classList.contains('collapsed')) {
        sbW = val('--sb-collapsed', 40);
      } else {
        sbW = sb.offsetWidth || 0;
      }
    }

    // ancho TOC si visible
    const tocW = (toc && !toc.classList.contains('hidden'))
                  ? (toc.offsetWidth || val('--subcat-width', 180))
                  : 0;

    const vw = document.documentElement.clientWidth || window.innerWidth;
    const usable = Math.max(0, vw - (sbW + tocW));

    // —— mitad derecha del área útil ——
    const rightW = Math.max(360, Math.floor(usable / 2));
    const leftOffset = Math.floor(sbW + tocW + (usable - rightW));

    document.documentElement.style.setProperty('--split-left', leftOffset + 'px');
    document.documentElement.style.setProperty('--split-w', rightW + 'px');
  }

  // Recalcular en resize
  window.addEventListener('resize', () => requestAnimationFrame(computeSplit));

  // Observar cambios de clase que afecten layout (sidebar, toc, body, modal)
  const watch = (el) => {
    if (!el) return;
    new MutationObserver(() => requestAnimationFrame(computeSplit))
      .observe(el, { attributes: true, attributeFilter: ['class', 'style'] });
  };
  document.addEventListener('DOMContentLoaded', () => {
    watch(document.getElementById('sidebar'));
    watch(document.getElementById('subcategoria-sidebar'));
    watch(document.body);
    watch(document.getElementById('video-modal'));

    // primer cálculo por si ya entras en split
    computeSplit();
  });

  // Si en algún punto tu código añade/quita .split-view, vuelve a calcular
  document.addEventListener('click', (e) => {
    // ejemplo: botón que activa el split
    if (e.target.closest('#expand-video')) {
      setTimeout(computeSplit, 0);
    }
    // ejemplo: botón que colapsa/oculta sidebar
    if (e.target.closest('#menu-toggle')) {
      setTimeout(computeSplit, 0);
    }
  });

  // Por si llamas a toggleSidebarCollapse() programáticamente
  const orig = window.toggleSidebarCollapse;
  if (typeof orig === 'function') {
    window.toggleSidebarCollapse = function(...args){
      const r = orig.apply(this, args);
      requestAnimationFrame(computeSplit);
      return r;
    };
  }
})();
</script>




</body>
</html>





/////////////
////////////
// —> 6:10
// —> 6:58
// —> 7:47
// 9: 59
//10 55
//10 agosto
//10 agosto tarde
//14 agosto
//14 agosto 2
//15 agosto
//16 agosto
//17 agosto noche noche noche amanecida
//18 agosto amanecida amanecida